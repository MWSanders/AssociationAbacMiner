import random
from collections import Counter

import pandas as pd
from sklearn.feature_extraction import DictVectorizer
from sklearn.feature_selection import *

from src.config import config
from src.job import job_utls
from src.model import RuleUtils
from pymongo import MongoClient
from src.model.ConfigurableEventNormalizer import ConfigurableEventNormalizerNg
from src.model import event_flattner

client = MongoClient('mongodb://localhost:27017', connectTimeoutMS=config.mongodb_timeout)
db = client.calp
events_collection = db.events
jobs_collection = db.abac_job_queue
possible_params2_collection = db.param_universe_info

all_fields = {'requestParameters_apigateway_createRestApiInput_description', 'requestParameters_codepipeline_pipeline_artifactStore_type', 'responseElements_group_path', 'requestParameters_ec2_customerGatewayId', 'responseElements_dBSubnetGroup_subnetGroupStatus', 'requestParameters_ec2_DescribeInstanceCreditSpecificationsRequest_InstanceId_tag', 'responseElements_image_imageId_imageTag', 'responseElements_task_desiredStatus', 'responseElements_webhookDeletedStatus', 'responseElements_userImportJob_creationDate', 'requestParameters_cognito-idp_emailVerificationSubject', 'requestParameters_waf-regional_timeWindow_endTime', 'requestParameters_ec2_instanceId', 'responseElements_group_groupName', 'responseElements_apikeyUsageplans_keyId', 'requestParameters_monitoring_alarmDescription', 'responseElements_environment_variables_bower_tmp', 'requestParameters_cognito-idp_adminCreateUserConfig_unusedAccountValidityDays', 'requestParameters_waf_nextMarker', 'requestParameters_lambda_handler', 'requestParameters_elasticloadbalancing_pageSize', 'requestParameters_ec2_domain', 'requestParameters_cognito-idp_domain', 'responseElements_repositoryMetadata_cloneUrlSsh', 'responseElements_pipelineExecution_status', 'requestParameters_ecs_count', 'responseElements_requesterId', 'requestParameters_kms_constraints_encryptionContextEquals_aws:lambda:FunctionArn', 'requestParameters_acm_maxItems', 'responseElements_deploymentUpdate_deploymentId', 'responseElements_AssociateIamInstanceProfileResponse_xmlns', 'requestParameters_ecs_serviceName', 'responseElements_methodResponses_200_methodresponseUpdate_httpMethod', 'responseElements_requestParameters_method\\u002erequest\\u002eheader\\u002eAuthorization', 'responseElements_methodResponses_200_methodresponseDelete_httpMethod', 'responseElements_group_arn', 'requestParameters_cognito-idp_clientName', 'responseElements_webACL_webACLId', 'responseElements_userPool_emailConfiguration_replyToEmailAddress', 'requestParameters_apigateway_createDomainNameInput_domainName', 'responseElements_task_taskArn', 'requestParameters_sqs_attribute_MaximumMessageSize', 'requestParameters_clouddirectory_developmentSchemaArn', 'responseElements_responseModels_application/json', 'responseElements_keyMetadata_creationDate', 'eventVersion', 'responseElements_virtualMFADevice_serialNumber', 'responseElements_pipeline_version', 'requestParameters_autoscaling_ebsOptimized', 'responseElements_methodDelete_resourceId', 'responseElements_self_apiKey', 'responseElements_userImportJob_startDate', 'responseElements_restApiId', 'requestParameters_ec2_attributeType', 'requestParameters_codepipeline_pipeline_name', 'requestParameters_rds_engineName', 'requestParameters_ec2_DescribeNatGatewaysRequest_Filter_Value_tag', 'requestParameters_lambda_environment_variables_SNS_PREFIX', 'requestParameters_elasticache_autoMinorVersionUpgrade', 'responseElements_environment_variables_ENVIRONMENT_REGION', 'responseElements_methodResponses_200_self_resourceId', 'vpcEndpointId', 'requestParameters_ec2_DeleteNatGatewayRequest_NatGatewayId', 'requestParameters_apigateway_createAuthorizerInput_type', 'requestParameters_kms_granteePrincipal', 'responseElements_functionArn', 'responseElements_integrationPut_restApiId', 'requestParameters_ec2_tenancy', 'requestParameters_cognito-idp_emailConfiguration_replyToEmailAddress', 'requestParameters_elasticmapreduce_releaseLabel', 'responseElements_sqlInjectionMatchSet_name', 'responseElements_authorizerUpdate_restApiId', 'responseElements_allocationId', 'requestParameters_kms_numberOfBytes', 'responseElements_changeToken', 'responseElements_apikeyDelete_apiKey', 'responseElements_restapiUpdate_restApiId', 'responseElements_expirationDate', 'responseElements_project_source_location', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseUpdate_resourceId', 'requestParameters_monitoring_threshold', 'responseElements_integrationresponsePut_resourceId', 'additionalEventData_service', 'requestParameters_kms_encryptionContext_aws:acm:arn', 'userIdentity_accessKeyId', 'requestParameters_glue_schemaChangePolicy_deleteBehavior', 'requestParameters_glue_databaseInput_name', 'responseElements_loginProfile_userName', 'responseElements_build_buildComplete', 'responseElements_environment_variables_kmsEncryptedHookUrl', 'responseElements_keyName', 'responseElements_methodPut_restApiId', 'responseElements_mailFromDomainAttributes_DerekD@SpaceflightIndustries\\u002ecom_behaviorOnMXFailure', 'responseElements_domainName', 'responseElements_environment_variables_ROOT_PATH', 'requestParameters_ec2_gatewayId', 'responseElements_environment_variables_ES_INDEX_PREFIX', 'requestParameters_autoscaling_serviceNamespace', 'responseElements_healthCheck_healthyThreshold', 'requestParameters_sqs_attributes_VisibilityTimeout', 'requestParameters_s3_LifecycleConfiguration_Rule_Expiration_Days', 'responseElements_userImportJob_jobName', 'requestParameters_ssm_nextToken', 'requestParameters_ec2_iamInstanceProfile_name', 'responseElements_vpnConnection_customerGatewayConfiguration', 'responseElements_methodUpdate_httpMethod', 'requestParameters_lambda_environment_variables_ENVIRONMENT_REGION', 'responseElements_stageName', 'requestParameters_elasticloadbalancing_targetGroupArn', 'requestParameters_ec2_portRange_from', 'requestParameters_kms_destinationEncryptionContext_aws:acm:arn', 'requestParameters_ec2_maxResults', 'requestParameters_s3_LifecycleConfiguration_Rule_ID', 'responseElements_throttleSettings_burstLimit', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseDelete_restApiId', 'responseElements_dBInstanceStatus', 'responseElements_lastModified', 'requestParameters_logs_logStreamNamePrefix', 'requestParameters_elasticmapreduce_jobFlowRole', 'requestParameters_ec2_peerVpcId', 'responseElements_location_path', 'requestParameters_rds_marker', 'requestParameters_elasticmapreduce_stepId', 'userIdentity_userName', 'requestParameters_apigateway_createDeploymentInput_stageName', 'requestParameters_lambda_memorySize', 'requestParameters_cloudformation_usePreviousTemplate', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseDelete_resourceId', 'responseElements_methodDelete_restApiId', 'responseElements_methodResponses_200_self_restApiId', 'responseElements_initialCaseStatus', 'requestParameters_elasticmapreduce_instances_hadoopVersion', 'responseElements_environment_variables_REGION', 'responseElements_cacheClusterStatus', 'requestParameters_waf_metricName', 'requestParameters_ec2_subnetId', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_targetOriginId', 'requestParameters_elasticache_showCacheClustersNotInReplicationGroups', 'responseElements_CreateNatGatewayResponse_natGateway_createTime', 'requestParameters_ecs_desiredStatus', 'requestParameters_cloudtrail_enableLogFileValidation', 'responseElements_taskDefinition_status', 'responseElements_usageGet_usagePlanId', 'responseElements_documentationversionByVersion_template', 'requestParameters_cloudfront_distributionConfig_webACLId', 'sourceIPAddress', 'requestParameters_apigateway_clientCertificateId', 'requestParameters_autoscaling_keyName', 'requestParameters_s3_NotificationConfiguration_TopicConfiguration_Id', 'responseElements_marker', 'requestParameters_apigateway_createDeploymentInput_description', 'requestParameters_ec2_allocationId', 'responseElements_restapiDelete_restApiId', 'requestParameters_ssm_withDecryption', 'requestParameters_support_includeResolvedCases', 'requestParameters_cloudfront_distributionConfig_logging_prefix', 'responseElements_finalCaseStatus', 'responseElements_project_description', 'requestParameters_iam_versionId', 'responseElements_service_desiredCount', 'responseElements_integrationresponseDelete_statusCode', 'requestParameters_cloudfront_invalidationBatch_paths_quantity', 'requestParameters_waf_name', 'requestParameters_ses_identityType', 'responseElements_networkAcl_networkAclId', 'responseElements_accountLimit_codeSizeUnzipped', 'requestParameters_autoscaling_defaultCooldown', 'requestParameters_lambda_environment_variables_kmsEncryptedHookUrl', 'requestParameters_cloudfront_distributionConfig_defaultRootObject', 'responseElements_vpcPeeringConnection_accepterVpcInfo_ownerId', 'requestParameters_ec2_ebsOptimized', 'responseElements_methodIntegration_self_resourceId', 'requestParameters_codepipeline_pipeline_version', 'requestParameters_config_configRule_inputParameters', 'requestParameters_ec2_imageId', 'responseElements_methodSettings_*/*_requireAuthorizationForCacheControl', 'responseElements_integrationResponses_200_integrationresponseDelete_httpMethod', 'requestParameters_apigateway_createApiKeyInput_generateDistinctId', 'responseElements_associationId', 'requestParameters_ecr_maxResults', 'responseElements_methodIntegration_integrationResponses_200_self_httpMethod', 'responseElements_stageCreate_restApiId', 'responseElements_environment_variables_bower_storage__links', 'requestParameters_config_resourceType', 'responseElements_endpoint_port', 'responseElements_gatewayresponseByType_restApiId', 'responseElements_keyMetadata_enabled', 'requestParameters_monitoring_statistic', 'requestParameters_autoscaling_nextToken', 'responseElements_methodSettings_*/*_throttlingRateLimit', 'responseElements_integrationResponses_200_statusCode', 'responseElements_project_encryptionKey', 'requestParameters_elasticache_cacheSubnetGroupDescription', 'requestParameters_kms_encryptionContext_PARAMETER_ARN', 'requestParameters_s3_ReplicationConfiguration_Role', 'requestParameters_ssm_path', 'responseElements_webACL_metricName', 'responseElements_keyFingerprint', 'requestParameters_ec2_groupId', 'requestParameters_kms_description', 'requestParameters_autoscaling_healthCheckGracePeriod', 'responseElements_healthCheck_interval', 'requestParameters_apigateway_createApiKeyInput_enabled', 'responseElements_task_launchType', 'requestParameters_apigateway_createDocumentationPartInput_location_type', 'requestParameters_cognito-idp_details_background-color', 'responseElements_deploymentDelete_restApiId', 'requestParameters_iam_serialNumber', 'responseElements_vpcPeeringConnection_vpcPeeringConnectionId', 'requestParameters_apigateway_limit', 'requestParameters_cloudfront_distributionConfig_isIPV6Enabled', 'responseElements_integrationResponses_200_integrationresponseDelete_resourceId', 'responseElements_cluster_clusterName', 'responseElements_image_repositoryName', 'requestParameters_ec2_DescribeVpcEndpointConnectionsRequest_maxResults', 'responseElements_identitySource', 'requestParameters_config_configurationRecorder_name', 'responseElements_dBSubnetGroupName', 'responseElements_dBName', 'requestParameters_kms_destinationKeyId', 'requestParameters_cloudtrail_isMultiRegionTrail', 'requestParameters_rds_allocatedStorage', 'responseElements_invalidation_invalidationBatch_callerReference', 'requestParameters_lambda_environment_variables_PRIVATE_DOMAIN', 'requestParameters_iam_policySourceArn', 'responseElements_taskDefinition_revision', 'responseElements_basepathmappingByBasePath_domainName', 'responseElements_imageId', 'responseElements_hostedZone_id', 'requestParameters_apigateway_putIntegrationInput_httpMethod', 'requestParameters_lambda_environment_variables_POD_NAME', 'responseElements_methodResponses_200_methodresponseUpdate_restApiId', 'responseElements_queryExecutionId', 'responseElements_CreateNatGatewayResponse_natGateway_state', 'responseElements_vpcPeeringConnection_accepterVpcInfo_vpcId', 'requestParameters_ecr_imageManifest', 'requestParameters_kms_constraints_encryptionContextEquals_aws:cloudfront:arn', 'responseElements_project_artifacts_packaging', 'requestParameters_iam_setAsDefault', 'requestParameters_autoscaling_minSize', 'requestParameters_clouddirectory_document', 'requestParameters_config_configRule_configRuleArn', 'requestParameters_ec2_availabilityZone', 'requestParameters_apigateway_createDomainNameInput_certificateArn', 'requestParameters_ecs_nextToken', 'responseElements_build_id', 'requestParameters_lambda_environment_variables_bower_storage__links', 'responseElements_tableDescription_tableSizeBytes', 'responseElements_dBSubnetGroup_dBSubnetGroupDescription', 'responseElements_modelByName_restApiId', 'requestParameters_cognito-idp_smsVerificationMessage', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_allowedMethods_cachedMethods_quantity', 'requestParameters_cloudfront_distributionConfig_enabled', 'responseElements_changeInfo_id', 'requestParameters_ses_emailAddress', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_forwardedValues_cookies_forward', 'responseElements_arn', 'responseElements_subscriptionArn', 'responseElements_userImportJob_status', 'responseElements_repositoryMetadata_cloneUrlHttp', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_accepterPeeringConnectionOptions_allowDnsResolutionFromRemoteVpc', 'requestParameters_support_severityCode', 'requestParameters_ecr_force', 'requestParameters_cloudfront_distributionConfig_restrictions_geoRestriction_restrictionType', 'requestParameters_autoscaling_maxSize', 'responseElements_environment_variables_bower_storage__packages', 'requestParameters_iam_instanceProfileName', 'requestParameters_elasticloadbalancing_loadBalancerArn', 'requestParameters_events_eventPattern', 'requestParameters_apigateway_createApiKeyInput_description', 'requestParameters_elasticloadbalancing_healthCheck_interval', 'responseElements_domainnameBasepathmappings_template', 'responseElements_totalDiscoveredResources', 'requestParameters_clouddirectory_schemaArn', 'requestParameters_autoscaling_stepScalingPolicyConfiguration_adjustmentType', 'responseElements_build_sourceVersion', 'responseElements_byteMatchSet_byteMatchSetId', 'requestParameters_apigateway_createAuthorizerInput_name', 'responseElements_integrationResponses_200_integrationresponseUpdate_httpMethod', 'requestParameters_kms_targetKeyId', 'requestParameters_sqs_attributes_DelaySeconds', 'responseElements_CheckMfa', 'requestParameters_autoscaling_resourceId', 'responseElements_nextToken', 'requestParameters_ec2_routeTableId', 'responseElements_documentationpartCreate_createDocumentationPartInput_location_method', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_forwardedValues_cookies_forward', 'responseElements_service_serviceArn', 'requestParameters_cloudfront_distributionConfig_viewerCertificate_minimumProtocolVersion', 'requestParameters_iam_roleName', 'requestParameters_lambda_environment_variables_bower_directory', 'responseElements_vpnConnection_options_staticRoutesOnly', 'requestParameters_cloudfront_distributionConfig_comment', 'requestParameters_autoscaling_protectedFromScaleIn', 'requestParameters_waf-regional_limit', 'responseElements_usageplanById_template', 'requestParameters_cognito-idp_emailConfiguration_sourceArn', 'responseElements_internetGateway_internetGatewayId', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_allowedMethods_quantity', 'responseElements_clientDownloadLandingPage', 'responseElements_integrationResponses_200_integrationresponseDelete_statusCode', 'responseElements_policyARN', 'responseElements_domainnameBasepathmappings_domainName', 'responseElements_logFileValidationEnabled', 'requestParameters_elasticmapreduce_instanceGroupId', 'responseElements_service_deploymentConfiguration_minimumHealthyPercent', 'responseElements_build_source_auth_type', 'requestParameters_ssm_resourceType', 'responseElements_distribution_distributionConfig_origins_quantity', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_allowedMethods_cachedMethods_quantity', 'responseElements_userPool_id', 'requestParameters_elasticloadbalancing_healthCheckIntervalSeconds', 'responseElements_dbiResourceId', 'requestParameters_waf_xssMatchSetId', 'responseElements_pipeline_roleArn', 'requestParameters_iam_maxItems', 'requestParameters_ses_identity', 'requestParameters_ec2_noReboot', 'requestParameters_rds_numberOfLines', 'responseElements_integrationresponseUpdate_httpMethod', 'responseElements_integrationResponses_200_self_resourceId', 'requestParameters_sns_subscriptionArn', 'responseElements_cloudwatchRoleArn', 'responseElements_vpc_instanceTenancy', 'responseElements_vpcPeeringConnection_requesterVpcInfo_vpcId', 'responseElements_methodresponseDelete_statusCode', 'responseElements_userPool_name', 'requestParameters_support_attachmentId', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseUpdate_statusCode', 'requestParameters_logs_limit', 'requestParameters_acm_certificateArn', 'requestParameters_datapipeline_version', 'responseElements_sparkApplicationSummary_name', 'responseElements_methodIntegration_self_restApiId', 'requestParameters_config_configurationRecorder_recordingGroup_includeGlobalResourceTypes', 'userIdentity_principalId', 'requestParameters_cognito-idp_refreshTokenValidity', 'requestParameters_apigateway_putMethodResponseInput_responseModels_image/png', 'requestParameters_ec2_instanceTenancy', 'requestParameters_config_configRule_scope_complianceResourceId', 'responseElements_build_logs_groupName', 'requestParameters_apigateway_createRestApiInput_cloneFrom', 'requestParameters_cloudtrail_trailName', 'responseElements_keyMetadata_arn', 'requestParameters_servicecatalog_pageSize', 'requestParameters_cognito-idp_adminCreateUserConfig_allowAdminCreateUserOnly', 'responseElements_distribution_distributionConfig_logging_enabled', 'responseElements_statement', 'responseElements_activity_statusCode', 'responseElements_trailARN', 'requestParameters_autoscaling_instanceId', 'responseElements_environment_variables_ES_HOST', 'requestParameters_cognito-identity_maxResults', 'responseElements_methodResponses_200_self_httpMethod', 'requestParameters_glue_databaseName', 'requestParameters_elasticloadbalancing_healthyThresholdCount', 'requestParameters_ec2_CreateNatGatewayRequest_SubnetId', 'requestParameters_cognito-idp_deviceConfiguration_challengeRequiredOnNewDevice', 'requestParameters_ssm_overwrite', 'responseElements_integrationPut_resourceId', 'requestParameters_apigateway_accepts', 'requestParameters_kms_encryptionContext_aws:s3:arn', 'responseElements_integrationResponses_200_integrationresponseUpdate_statusCode', 'requestParameters_cloudfront_ifMatch', 'requestParameters_apigateway_putIntegrationInput_requestTemplates_application/json', 'responseElements_cacheParameterGroup_cacheParameterGroupName', 'responseElements_tableDescription_provisionedThroughput_lastIncreaseDateTime', 'requestParameters_kms_requestPayer', 'requestParameters_ec2_AssociateIamInstanceProfileRequest_InstanceId', 'responseElements_apiKeyVersion', 'responseElements_stageUpdate_stageName', 'responseElements_restapiRequestValidators_restApiId', 'requestParameters_support_nextToken', 'responseElements_AssociateIamInstanceProfileResponse_iamInstanceProfileAssociation_iamInstanceProfile_id', 'responseElements_mailFromDomainAttributes_derekd@spaceflightindustries\\u002ecom_behaviorOnMXFailure', 'requestParameters_ec2_disableApiTermination_value', 'requestParameters_codepipeline_transitionType', 'requestParameters_cloudfront_distributionConfig_customErrorResponses_quantity', 'requestParameters_sqs_queueUrl', 'requestParameters_datapipeline_uniqueId', 'requestParameters_kms_keyId', 'requestParameters_ec2_associationId', 'responseElements_changeInfo_comment', 'requestParameters_logs_logStreamName', 'requestParameters_datapipeline_status', 'requestParameters_s3_WebsiteConfiguration_xmlns', 'requestParameters_route53domains_sort', 'requestParameters_route53_maxItems', 'requestParameters_s3_NotificationConfiguration_xmlns', 'requestParameters_kms_constraints_encryptionContextEquals_aws:acm:arn', 'requestParameters_waf_iPSetId', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_xmlns', 'responseElements_methodResponses_200_methodresponseDelete_restApiId', 'requestParameters_cloudfront_invalidationBatch_callerReference', 'requestParameters_ecs_family', 'eventName', 'responseElements_userPool_adminCreateUserConfig_unusedAccountValidityDays', 'requestParameters_s3_AccessControlPolicy_AccessControlList_Grant_Grantee_DisplayName', 'requestParameters_sns_nextToken', 'requestParameters_elasticmapreduce_logUri', 'requestParameters_cognito-idp_poolName', 'responseElements_methodIntegration_integrationResponses_200_statusCode', 'additionalEventData', 'responseElements_build_source_type', 'responseElements_userPoolUIConfiguration_lastModifiedDate', 'responseElements_identityPoolName', 'requestParameters_ecs_status', 'requestParameters_codebuild_payerId', 'requestParameters_ec2_DescribeSecurityGroupReferencesRequest_GroupId_tag', 'requestParameters_codepipeline_pipeline_artifactStore_location', 'responseElements_authorizerId', 'requestParameters_lambda_code_s3Bucket', 'requestParameters_elasticloadbalancing_loadBalancerAttributes_connectionDraining_enabled', 'responseElements_customerGateway_ipAddress', 'requestParameters_ec2_networkAclId', 'responseElements_accountUsage_totalCodeSize', 'responseElements_integrationResponses_200_integrationresponseUpdate_restApiId', 'responseElements_role_assumeRolePolicyDocument', 'requestParameters_lambda_functionVersion', 'responseElements_integrationUpdate_restApiId', 'responseElements_documentationpartCreate_createDocumentationPartInput_properties', 'requestParameters_lambda_environment_variables_SERVICE', 'responseElements_vpnConnection_vpnGatewayId', 'responseElements_methodIntegration_integrationUpdate_resourceId', 'requestParameters_waf_byteMatchSetId', 'responseElements_usageplanDelete_usagePlanId', 'requestParameters_waf-regional_resourceArn', 'responseElements_integrationResponses_200_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Origin', 'responseElements_methodIntegration_integrationDelete_httpMethod', 'requestParameters_ec2_DescribeVpcEndpointServiceConfigurationsRequest_maxResults', 'requestParameters_ecs_taskDefinition', 'requestParameters_cloudtrail_nextToken', 'requestParameters_athena_maxResults', 'responseElements_distribution_distributionConfig_comment', 'requestParameters_ec2_DescribeHostsRequest_Filter_Value_content', 'requestParameters_apigateway_createDeploymentInput_stageDescription', 'responseElements_loadBalancerAttributes_connectionSettings_idleTimeout', 'requestParameters_cognito-idp_details_image-key', 'responseElements_cACertificateIdentifier', 'requestParameters_cognito-sync_identityPoolId', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_targetOriginId', 'responseElements_self_template', 'requestParameters_ssm_maxResults', 'requestParameters_elasticloadbalancing_protocol', 'requestParameters_lambda_environment_variables_POOLID', 'responseElements_keyMaterial', 'responseElements_integrationresponseUpdate_restApiId', 'responseElements_loadBalancerAttributes_crossZoneLoadBalancing_enabled', 'responseElements_uICustomization_lastModifiedDate', 'requestParameters_elasticache_cacheNodeType', 'requestParameters_s3_VersioningConfiguration_xmlns', 'responseElements_environment_variables_LOG_LEVEL', 'requestParameters_cognito-idp_clientId', 'requestParameters_config_deliveryChannelName', 'responseElements_basepathmappingDelete_basePath', 'responseElements_build_buildStatus', 'responseElements_environment_variables_slackChannel', 'userIdentity_type', 'requestParameters_ec2_networkInterfaceId', 'responseElements_tableDescription_provisionedThroughput_readCapacityUnits', 'requestParameters_rds_sourceType', 'responseElements_distribution_distributionConfig_webACLId', 'requestParameters_autoscaling_roleARN', 'requestParameters_apigateway_createApiKeyInput_name', 'responseElements_usageplanUpdate_usagePlanId', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_compress', 'requestParameters_autoscaling_endTime', 'requestParameters_ssm_resourceId', 'responseElements_mailFromDomainAttributes_dev\\u002ealertwhere\\u002ecom_behaviorOnMXFailure', 'responseElements_methodSettings_*/*_metricsEnabled', 'requestParameters_sns_protocol', 'requestParameters_ecr_partFirstByte', 'requestParameters_rds_listSupportedCharacterSets', 'responseElements_userPool_policies_passwordPolicy_requireLowercase', 'responseElements_integrationResponses_200_responseTemplates_application/json', 'requestParameters_cloudfront_distributionConfig_viewerCertificate_certificate', 'requestParameters_elasticache_duration', 'responseElements_credentials_expiration', 'requestParameters_config_deliveryChannel_s3BucketName', 'responseElements_methodresponsePut_httpMethod', 'responseElements_methodByHttpMethod_restApiId', 'responseElements_CreateNatGatewayResponse_requestId', 'requestParameters_apigateway_createDocumentationPartInput_properties', 'requestParameters_route53_hostedZoneId', 'requestParameters_cognito-idp_jobId', 'requestParameters_ec2_DescribeSecurityGroupReferencesRequest_GroupId_content', 'requestParameters_ec2_DescribeNatGatewaysRequest_Filter_Value_content', 'responseElements_storageType', 'responseElements_build_logs_deepLink', 'responseElements_methodUpdate_resourceId', 'responseElements_pendingModifiedValues_masterUserPassword', 'responseElements_service_runningCount', 'responseElements_rule_metricName', 'responseElements_activity_details', 'responseElements_methodResponses_200_self_statusCode', 'requestParameters_rds_dBInstanceIdentifier', 'requestParameters_cloudtrail_includeGlobalServiceEvents', 'responseElements_taskDefinition_family', 'responseElements_tableDescription_tableId', 'requestParameters_logs_logGroupName', 'responseElements_activity_autoScalingGroupName', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseUpdate_restApiId', 'responseElements_methodIntegration_integrationresponsePut_httpMethod', 'responseElements_preferredMaintenanceWindow', 'responseElements_task_connectivityAt', 'responseElements_stackId', 'responseElements_project_source_type', 'requestParameters_config_configRule_description', 'responseElements_authorizerUri', 'responseElements_resourceById_restApiId', 'responseElements_stageFlushAuthorizerCache_restApiId', 'responseElements_DeleteNatGatewayResponse_natGatewayId', 'responseElements_userPoolClient_clientSecret', 'responseElements_distribution_inProgressInvalidationBatches', 'responseElements_endpoint_address', 'responseElements_user_createDate', 'requestParameters_monitoring_metricName', 'responseElements_build_startTime', 'requestParameters_logs_filterName', 'responseElements_userPool_deviceConfiguration_challengeRequiredOnNewDevice', 'responseElements_path', 'requestParameters_ecs_clusterName', 'responseElements_methodIntegration_httpMethod', 'responseElements_role_createDate', 'responseElements_usageplankeyDelete_keyId', 'requestParameters_config_configRule_maximumExecutionFrequency', 'userIdentity_invokedBy', 'responseElements_ExitRole', 'responseElements_task_version', 'responseElements_requestId', 'responseElements_pipelineExecution_pipelineVersion', 'responseElements_accessKey_accessKeyId', 'responseElements_methodSettings_*/*_dataTraceEnabled', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_requesterPeeringConnectionOptions_allowDnsResolutionFromRemoteVpc', 'responseElements_restapiGatewayResponses_restApiId', 'requestParameters_elasticloadbalancing_healthCheck_healthyThreshold', 'requestParameters_config_limit', 'responseElements_dBSubnetGroup_dBSubnetGroupName', 'requestParameters_cloudformation_stackName', 'requestParameters_elasticloadbalancing_port', 'errorCode', 'requestParameters_apigateway_includeValue', 'requestParameters_elasticmapreduce_autoScalingRole', 'requestParameters_ses_snsTopic', 'responseElements_rule_ruleId', 'userIdentity_sessionContext_attributes_mfaAuthenticated', 'responseElements_ConsoleLogin', 'requestParameters_apigateway_stageName', 'requestParameters_ec2_internetGatewayId', 'responseElements_customerGateway_type', 'responseElements_task_stoppedReason', 'requestParameters_elasticloadbalancing_matcher_httpCode', 'responseElements_keyMetadata_aWSAccountId', 'requestParameters_lambda_environment_variables_bower_save', 'responseElements_cluster_clusterArn', 'responseElements_self_title', 'responseElements_basepathmappingDelete_domainName', 'requestParameters_ec2_AssociateIamInstanceProfileRequest_IamInstanceProfile_Name', 'responseElements_methodresponseDelete_resourceId', 'requestParameters_lambda_environment_variables_bower_tmp', 'responseElements_basepathmappingCreate_domainName', 'responseElements_autoMinorVersionUpgrade', 'requestParameters_kinesis_streamName', 'responseElements_repositoryId', 'responseElements_methodIntegration_integrationResponses_200_self_statusCode', 'responseElements_task_clusterArn', 'requestParameters_kms_origin', 'responseElements_environment_variables_PRIVATE_DOMAIN', 'responseElements_userPool_policies_passwordPolicy_minimumLength', 'requestParameters_lightsail_includeAvailabilityZones', 'requestParameters_apigateway_putIntegrationInput_requestParameters_integration\\u002erequest\\u002epath\\u002eproxy', 'responseElements_invalidation_id', 'responseElements_environment_variables_SNS_PREFIX', 'responseElements_integrationResponses_200_self_restApiId', 'requestParameters_elasticloadbalancing_loadBalancerAttributes_connectionSettings_idleTimeout', 'requestParameters_events_name', 'responseElements_hostedZone_resourceRecordSetCount', 'responseElements_keyMetadata_keyId', 'requestParameters_apigateway_modelName', 'requestParameters_lambda_publish', 'requestParameters_s3_NotificationConfiguration_TopicConfiguration_Topic', 'requestParameters_glue_name', 'requestID', 'responseElements_assumedRoleUser_assumedRoleId', 'responseElements_clientCertificateId', 'requestParameters_apigateway_parameters_extensions', 'responseElements_userPool_lambdaConfig_postConfirmation', 'requestParameters_sqs_attributes_ReceiveMessageWaitTimeSeconds', 'responseElements_CreateNatGatewayResponse_natGateway_subnetId', 'responseElements_repositoryName', 'responseElements_integrationResponses_200_integrationresponseUpdate_resourceId', 'responseElements_vPC_vPCId', 'responseElements_vpnConnection_customerGatewayId', 'responseElements_requestParameters_integration\\u002erequest\\u002epath\\u002eproxy', 'requestParameters_elasticmapreduce_instances_terminationProtected', 'responseElements_jobFlowId', 'responseElements_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Headers', 'requestParameters_autoscaling_policyName', 'requestParameters_logs_retentionInDays', 'responseElements_task_createdAt', 'responseElements_methodresponseDelete_httpMethod', 'responseElements_CreateNatGatewayResponse_clientToken', 'requestParameters_iam_pathPrefix', 'requestParameters_apigateway_createUsagePlanInput_description', 'requestParameters_elasticmapreduce_marker', 'responseElements_AssociateIamInstanceProfileResponse_iamInstanceProfileAssociation_instanceId', 'responseElements_methodresponseUpdate_httpMethod', 'responseElements_pathPart', 'requestParameters_ec2_volumeId', 'responseElements_tableDescription_provisionedThroughput_lastDecreaseDateTime', 'responseElements_distribution_distributionConfig_restrictions_geoRestriction_restrictionType', 'requestParameters_dynamodb_provisionedThroughput_writeCapacityUnits', 'responseElements_networkAcl_vpcId', 'requestParameters_apigateway_body_bigEndian', 'requestParameters_ec2_vpnConnectionId', 'requestParameters_sns_endpoint', 'requestParameters_lambda_marker', 'responseElements_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Origin', 'responseElements_uICustomization_creationDate', 'responseElements_pemEncodedCertificate', 'requestParameters_ecs_sort', 'requestParameters_rds_sourceIdentifier', 'requestParameters_athena_clientRequestToken', 'responseElements_policyVersion_isDefaultVersion', 'requestParameters_ecs_deploymentConfiguration_minimumHealthyPercent', 'requestParameters_apigateway_createAuthorizerInput_identitySource', 'requestParameters_s3_ReplicationConfiguration_Rule_Status', 'responseElements_methodSettings_*/*_cacheTtlInSeconds', 'requestParameters_ec2_userData', 'responseElements_gatewayresponseByType_template', 'responseElements_deploymentUpdate_restApiId', 'requestParameters_apigateway_createUsagePlanKeyInput_keyId', 'responseElements_sizeConstraintSet_sizeConstraintSetId', 'requestParameters_lambda_functionName', 'requestParameters_ec2_startTime', 'requestParameters_apigateway_parameters_endpointConfigurationTypes', 'requestParameters_ec2_vpnGatewayId', 'responseElements_service_status', 'responseElements_changeInfo_submittedAt', 'responseElements_build_environment_computeType', 'requestParameters_ec2_DescribeVpcEndpointConnectionNotificationsRequest_maxResults', 'responseElements_stageDelete_stageName', 'requestParameters_support_issueType', 'responseElements_statusCode', 'responseElements_userPoolClient_creationDate', 'responseElements_self_name', 'responseElements_pipelineId', 'requestParameters_waf_defaultAction_type', 'responseElements_dBInstanceClass', 'requestParameters_route53_startRecordType', 'requestParameters_ssm_description', 'responseElements_engineVersion', 'responseElements_methodResponses_200_methodresponseUpdate_resourceId', 'responseElements_instanceProfile_createDate', 'responseElements_dBSubnetGroup_vpcId', 'requestParameters_waf_sqlInjectionMatchSetId', 'requestParameters_ec2_destinationCidrBlock', 'requestParameters_events_event', 'responseElements_pipeline_artifactStore_location', 'requestParameters_elasticloadbalancing_loadBalancerName', 'requestParameters_events_state', 'requestParameters_apigateway_exportType', 'responseElements_user_userId', 'requestParameters_iam_accessKeyId', 'responseElements_self_stageName', 'requestParameters_route53_resourceType', 'responseElements_routeTable_vpcId', 'requestParameters_sns_attributeName', 'requestParameters_cognito-idp_lambdaConfig_customMessage', 'requestParameters_waf-regional_maxItems', 'requestParameters_config_deliveryChannel_s3KeyPrefix', 'responseElements_instanceProfile_arn', 'responseElements_gatewayresponsePut_template', 'responseElements_AssociateIamInstanceProfileResponse_requestId', 'responseElements_distribution_distributionConfig_viewerCertificate_sSLSupportMethod', 'requestParameters_ec2_portRange_to', 'requestParameters_sqs_attribute_ReceiveMessageWaitTimeSeconds', 'requestParameters_apigateway_putIntegrationInput_uri', 'responseElements_self_clientCertificateId', 'responseElements_environment_variables_POD_NAME', 'responseElements_dBParameterGroupArn', 'requestParameters_config_deliveryChannel_name', 'responseElements_distribution_distributionConfig_enabled', 'requestParameters_waf-regional_webACLId', 'requestParameters_ec2_fromPort', 'responseElements_methodIntegration_integrationDelete_restApiId', 'responseElements_loginProfile_passwordResetRequired', 'responseElements_methodIntegration_integrationresponsePut_restApiId', 'responseElements_userImportJob_userPoolId', 'responseElements_image_imageManifest', 'requestParameters_rds_logFileName', 'responseElements_restapiDeployments_template', 'responseElements_repositoryMetadata_repositoryId', 'requestParameters_sqs_queueName', 'requestParameters_cloudformation_roleARN', 'requestParameters_s3_ReplicationConfiguration_Rule_Destination_AccessControlTranslation_Owner', 'requestParameters_s3_ReplicationConfiguration_Rule_Destination_StorageClass', 'responseElements_distribution_distributionConfig_viewerCertificate_aCMCertificateArn', 'requestParameters_cognito-idp_adminCreateUserConfig_inviteMessageTemplate_sMSMessage', 'requestParameters_elasticache_maxRecords', 'responseElements_build_logs_streamName', 'responseElements_mailFromDomainAttributes_matts@spaceflightindustries\\u002ecom_behaviorOnMXFailure', 'requestParameters_waf-regional_xssMatchSetId', 'responseElements_task_memory', 'responseElements_resourceDelete_resourceId', 'requestParameters_ec2_natGatewayId', 'requestParameters_rds_includePublic', 'responseElements_policy_updateDate', 'responseElements_modelCreate_restApiId', 'requestParameters_support_language', 'responseElements_userPoolClient_clientId', 'requestParameters_sqs_attribute_MessageRetentionPeriod', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_viewerProtocolPolicy', 'awsRegion', 'requestParameters_s3_NotificationConfiguration_CloudFunctionConfiguration_Id', 'requestParameters_ecs_familyPrefix', 'requestParameters_ec2_DescribeEgressOnlyInternetGatewaysRequest_MaxResults', 'requestParameters_codebuild_userArn', 'requestParameters_glue_role', 'responseElements_runtime', 'requestParameters_ec2_attribute', 'responseElements_caseId', 'responseElements_distribution_distributionConfig_httpVersion', 'responseElements_userPoolUIConfiguration_details_ALL_image-key', 'requestParameters_lambda_tags_Environment', 'requestParameters_ec2_attachmentId', 'responseElements_task_startedAt', 'requestParameters_autoscaling_scalableDimension', 'requestParameters_ec2_groupName', 'responseElements_assumedRoleUser_arn', 'requestParameters_ecs_startedBy', 'requestParameters_codepipeline_pipelineName', 'responseElements_stageUpdate_restApiId', 'responseElements_resourceCreateChild_restApiId', 'requestParameters_s3_bucketName', 'responseElements_pipelineExecutionId', 'requestParameters_ses_domain', 'requestParameters_cognito-idp_jobName', 'requestParameters_lambda_tracingConfig_mode', 'responseElements_task_connectivity', 'requestParameters_organizations_filter_actionType', 'responseElements_vpcConfig_vpcId', 'requestParameters_autoscaling_adjustmentType', 'apiVersion', 'requestParameters_cloudfront_resource', 'requestParameters_apigateway_createResourceInput_pathPart', 'requestParameters_cognito-idp_mfaConfiguration', 'requestParameters_ec2_toPort', 'responseElements_integrationPut_httpMethod', 'requestParameters_elasticmapreduce_ebsRootVolumeSize', 'responseElements_instanceProfile_instanceProfileId', 'requestParameters_ec2_instanceInitiatedShutdownBehavior', 'responseElements_documentationversionCreate_restApiId', 'requestParameters_cloudfront_distributionConfig_viewerCertificate_sSLSupportMethod', 'requestParameters_servicecatalog_sortOrder', 'requestParameters_rds_engine', 'requestParameters_s3_ReplicationConfiguration_Rule_Destination_Account', 'responseElements_modelCreate_createModelInput_name', 'requestParameters_elasticache_showNodeGroupConfig', 'requestParameters_cognito-idp_policies_passwordPolicy_requireSymbols', 'responseElements_subnet_vpcId', 'responseElements_documentationpartUpdate_restApiId', 'requestParameters_ssm_recursive', 'responseElements_capabilitiesReason', 'responseElements_environment_variables_ENVIRONMENT_NAME', 'responseElements_lastUpdatedDate', 'requestParameters_apigateway_failOnWarnings', 'responseElements_taskDefinition_taskDefinitionArn', 'responseElements_uICustomization_cSS', 'requestParameters_cloudtrail_resourceId', 'responseElements_distribution_distributionConfig_priceClass', 'requestParameters_apigateway_parameters_failonwarnings', 'responseElements_publishedSchemaArn', 'requestParameters_s3_NotificationConfiguration_QueueConfiguration_Filter_S3Key_FilterRule_Name', 'requestParameters_route53_vPC_vPCId', 'responseElements_documentationpartCreate_createDocumentationPartInput_location_type', 'requestParameters_ec2_DescribeStaleSecurityGroupsRequest_MaxResults', 'responseElements_subnet_subnetId', 'responseElements_methodresponsePut_resourceId', 'requestParameters_ses_policyName', 'responseElements_customerGateway_bgpAsn', 'requestParameters_events_limit', 'responseElements_licenseModel', 'responseElements_id', 'requestParameters_lambda_includeDeprecatedFeaturesAccess', 'requestParameters_ec2_DescribeHostsRequest_Filter_Value_tag', 'requestParameters_acm_domainName', 'requestParameters_elasticache_showCacheNodeInfo', 'responseElements_basepathmappingByBasePath_template', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_defaultTTL', 'responseElements_distribution_distributionConfig_defaultRootObject', 'requestParameters_events_description', 'responseElements_environment_variables_bower_save', 'requestParameters_apigateway_putIntegrationInput_contentHandling', 'requestParameters_config_configRule_configRuleId', 'responseElements_s3BucketName', 'responseElements_policy_policyId', 'responseElements_resourceCreateChild_parentId', 'responseElements_attachmentSetId', 'requestParameters_waf-regional_sizeConstraintSetId', 'requestParameters_waf-regional_timeWindow_startTime', 'userIdentity_arn', 'responseElements_environment_variables_BUCKET', 'responseElements_DeleteNatGatewayResponse_requestId', 'responseElements_methodResponses_200_methodresponseUpdate_statusCode', 'responseElements_project_artifacts_location', 'responseElements_methodresponseUpdate_restApiId', 'requestParameters_inspector_maxResults', 'requestParameters_autoscaling_policyType', 'responseElements_project_name', 'responseElements_pipeline_name', 'requestParameters_ecr_filter_tagStatus', 'responseElements_cluster_status', 'requestParameters_rds_dBParameterGroupFamily', 'requestParameters_elasticloadbalancing_healthCheck_timeout', 'requestParameters_apigateway_putMethodResponseInput_responseModels_application/json', 'responseElements_policyVersion_createDate', 'requestParameters_ssm_value', 'responseElements_build_initiator', 'responseElements_includeGlobalServiceEvents', 'responseElements_deploymentStages_deploymentId', 'requestParameters_codecommit_sortBy', 'requestParameters_s3_AccessControlPolicy_xmlns', 'requestParameters_support_serviceCode', 'requestParameters_ecr_imageTag', 'responseElements_documentationpartById_restApiId', 'requestParameters_datapipeline_limit', 'requestParameters_lambda_codeSha256', 'requestParameters_lambda_qualifier', 'responseElements_service_taskDefinition', 'requestParameters_dynamodb_resourceArn', 'responseElements_requestvalidatorById_template', 'responseElements_apikeyUpdate_apiKey', 'responseElements_sparkApplicationSummary_id', 'responseElements_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Methods', 'requestParameters_iam_path', 'responseElements_cacheSubnetGroupDescription', 'requestParameters_ecr_repositoryName', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_viewerProtocolPolicy', 'requestParameters_ec2_options_staticRoutesOnly', 'responseElements_methodIntegration_integrationresponsePut_template', 'responseElements_distribution_distributionConfig_viewerCertificate_certificate', 'responseElements_vpcPeeringConnection_requesterVpcInfo_ownerId', 'requestParameters_kms_destinationEncryptionContext_aws:cloudfront:arn', 'requestParameters_cloudformation_disableRollback', 'requestParameters_elasticloadbalancing_unhealthyThresholdCount', 'requestParameters_waf-regional_changeToken', 'responseElements_stageFlushAuthorizerCache_stageName', 'requestParameters_cloudtrail_startTime', 'responseElements_self_resourceId', 'responseElements_userPool_adminCreateUserConfig_allowAdminCreateUserOnly', 'requestParameters_servicecatalog_sortBy', 'requestParameters_elasticache_cacheSubnetGroupName', 'responseElements_project_environment_privilegedMode', 'requestParameters_ssm_type', 'requestParameters_lambda_environment_variables_bower_storage__registry', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseDelete_httpMethod', 'responseElements_type', 'requestParameters_apigateway_apiKey', 'responseElements_invalidation_createTime', 'requestParameters_cognito-idp_policies_passwordPolicy_requireLowercase', 'requestParameters_rds_engineVersion', 'requestParameters_cognito-idp_lambdaConfig_defineAuthChallenge', 'responseElements_integrationresponsePut_template', 'responseElements_clientcertificateUpdate_clientCertificateId', 'requestParameters_elasticmapreduce_name', 'requestParameters_waf_maxItems', 'requestParameters_apigateway_body_limit', 'requestParameters_elasticloadbalancing_name', 'responseElements_vpnGateway_vpnGatewayId', 'requestParameters_lambda_code_s3Key', 'requestParameters_codepipeline_maxResults', 'responseElements_AssociateIamInstanceProfileResponse_iamInstanceProfileAssociation_iamInstanceProfile_arn', 'responseElements_project_created', 'requestParameters_ssm_keyId', 'requestParameters_apigateway_parentId', 'responseElements_integrationResponses_200_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Methods', 'userAgent', 'responseElements_documentationversionByVersion_restApiId', 'requestParameters_ec2_DescribeHostsRequest_Filter_Name', 'responseElements_registryId', 'responseElements_isMultiRegionTrail', 'responseElements_environment_variables_DYNAMODB_PREFIX', 'responseElements_uICustomization_imageUrl', 'responseElements_policyVersion_document', 'responseElements_methodIntegration_uri', 'requestParameters_config_configRuleName', 'responseElements_AssociateIamInstanceProfileResponse_iamInstanceProfileAssociation_associationId', 'responseElements_repository_registryId', 'requestParameters_autoscaling_vPCZoneIdentifier', 'requestParameters_logs_roleArn', 'requestParameters_s3_NotificationConfiguration_QueueConfiguration_Queue', 'responseElements_dBInstanceArn', 'requestParameters_cognito-idp_imageFile_limit', 'requestParameters_lambda_runtime', 'responseElements_codeSize', 'responseElements_userPoolUIConfiguration_creationDate', 'requestParameters_route53_id', 'responseElements_authType', 'responseElements_userImportJob_jobId', 'responseElements_vpcPeeringConnection_requesterVpcInfo_cidrBlock', 'responseElements_integrationresponseDelete_restApiId', 'responseElements_clientcertificateDelete_clientCertificateId', 'responseElements_basepathmappingUpdate_basePath', 'responseElements_user_path', 'requestParameters_monitoring_alarmName', 'requestParameters_iam_userName', 'responseElements_xssMatchSet_name', 'requestParameters_apigateway_resourceId', 'responseElements_build_environment_privilegedMode', 'responseElements_repositoryMetadata_creationDate', 'additionalEventData_SwitchFrom', 'responseElements_methodResponses_200_self_title', 'responseElements_version', 'requestParameters_iam_status', 'responseElements_dNSName', 'responseElements_webACL_name', 'requestParameters_cognito-idp_cloudWatchLogsRoleArn', 'requestParameters_s3_NotificationConfiguration_CloudFunctionConfiguration_CloudFunction', 'responseElements_tableDescription_creationDateTime', 'responseElements_accountLimit_totalCodeSize', 'requestParameters_es_elasticsearchVersion', 'requestParameters_elasticmapreduce_clusterId', 'responseElements_project_cache_type', 'responseElements_methodIntegration_integrationResponses_200_self_title', 'requestParameters_cloudtrail_name', 'responseElements_methodPut_template', 'requestParameters_waf_sizeConstraintSetId', 'requestParameters_apigateway_basePath', 'responseElements_vpcPeeringConnection_status_code', 'responseElements_repository_repositoryArn', 'requestParameters_lambda_resource', 'requestParameters_lambda_environment_variables_ENVIRONMENT_NAME', 'responseElements_integrationResponses_200_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Headers', 'responseElements_modelCreate_createModelInput_schema', 'responseElements_usageGet_startDate', 'requestParameters_cloudfront_distributionConfig_viewerCertificate_cloudFrontDefaultCertificate', 'requestParameters_waf_webAclId', 'responseElements_role_arn', 'responseElements_vPC_vPCRegion', 'requestParameters_elasticmapreduce_visibleToAllUsers', 'requestParameters_cognito-idp_maxResults', 'responseElements_deploymentDelete_deploymentId', 'responseElements_documentationpartImport_restApiId', 'requestParameters_waf-regional_webAclId', 'responseElements_integrationresponseUpdate_statusCode', 'requestParameters_waf-regional_sqlInjectionMatchSetId', 'requestParameters_autoscaling_maxResults', 'requestParameters_iam_marker', 'responseElements_vpc_vpcId', 'requestParameters_ec2_disableApiTermination', 'responseElements_DeleteNatGatewayResponse_xmlns', 'requestParameters_config_configurationRecorder_roleARN', 'requestParameters_monitoring_treatMissingData', 'requestParameters_lambda_ignored', 'requestParameters_lambda_environment_variables_HookUrl', 'responseElements_requestParameters_method\\u002erequest\\u002epath\\u002eproxy', 'requestParameters_rds_storageType', 'responseElements_tags_Environment', 'requestParameters_rds_dBParameterGroupName', 'responseElements_task_startedBy', 'requestParameters_elasticloadbalancing_healthCheck_target', 'requestParameters_apigateway_putMethodInput_authorizationType', 'requestParameters_cloudfront_distributionConfig_viewerCertificate_aCMCertificateArn', 'requestParameters_elasticmapreduce_applicationId', 'responseElements_vpnGateway_type', 'responseElements_vpc_cidrBlock', 'requestParameters_ec2_ModifyVpcPeeringConnectionOptionsRequest_RequesterPeeringConnectionOptions_AllowDnsResolutionFromRemoteVpc', 'responseElements_uICustomization_clientId', 'responseElements_methodIntegration_integrationresponsePut_resourceId', 'responseElements_role_path', 'responseElements_policy_path', 'requestParameters_elasticloadbalancing_healthCheckPath', 'requestParameters_ec2_enableDnsSupport_value', 'requestParameters_route53_recordName', 'responseElements_restapiStages_template', 'responseElements_masterUsername', 'responseElements_AssociateIamInstanceProfileResponse_iamInstanceProfileAssociation_state', 'responseElements_userPool_policies_passwordPolicy_requireUppercase', 'requestParameters_monitoring_stateValue', 'requestParameters_autoscaling_autoScalingGroupName', 'requestParameters_ec2_iamInstanceProfile_arn', 'responseElements_distribution_lastModifiedTime', 'requestParameters_ec2_dhcpOptionsId', 'additionalEventData_RedirectTo', 'requestParameters_cloudfront_id', 'responseElements_basepathmappingUpdate_domainName', 'responseElements_integrationresponseUpdate_resourceId', 'requestParameters_clouddirectory_name', 'requestParameters_health_locale', 'responseElements_byteMatchSet_name', 'responseElements_self_authorizerId', 'responseElements_stageDelete_restApiId', 'responseElements_build_environment_type', 'requestParameters_waf-regional_ruleId', 'requestParameters_route53_startRecordName', 'requestParameters_config_resourceId', 'requestParameters_autoscaling_launchConfigurationName', 'requestParameters_autoscaling_stepScalingPolicyConfiguration_metricAggregationType', 'responseElements_role_roleId', 'responseElements_dBParameterGroupFamily', 'responseElements_iPSet_iPSetId', 'requestParameters_clouddirectory_directoryArn', 'responseElements_distribution_distributionConfig_viewerCertificate_minimumProtocolVersion', 'responseElements_hostedZone_config_privateZone', 'requestParameters_cloudfront_distributionConfig_logging_bucket', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_forwardedValues_headers_quantity', 'responseElements_service_deploymentConfiguration_maximumPercent', 'requestParameters_waf-regional_name', 'requestParameters_apigateway_statusCode', 'responseElements_policy_policyName', 'responseElements_keyMetadata_origin', 'requestParameters_ec2_DescribeStaleSecurityGroupsRequest_VpcId', 'responseElements_mfaConfiguration', 'requestParameters_inspector_roleArn', 'requestParameters_waf_changeToken', 'requestParameters_monitoring_comparisonOperator', 'responseElements_complianceSummary_compliantResourceCount_cappedCount', 'responseElements_restapiDocumentationParts_restApiId', 'requestParameters_kms_retiringPrincipal', 'requestParameters_lambda_environment_variables_BUCKET', 'requestParameters_iam_virtualMFADeviceName', 'responseElements_snapshotWindow', 'responseElements_createdDate', 'responseElements_complianceSummary_nonCompliantResourceCount_cappedCount', 'responseElements_policyVersion_versionId', 'responseElements_complianceSummary_complianceSummaryTimestamp', 'responseElements_vpcPeeringConnection_status_message', 'requestParameters_cloudformation_onFailure', 'responseElements_vpnGateway_state', 'requestParameters_apigateway_putMethodInput_requestParameters_method\\u002erequest\\u002epath\\u002eproxy', 'responseElements_documentationpartDelete_documentationPartId', 'responseElements_userPoolClient_refreshTokenValidity', 'requestParameters_elasticache_engine', 'responseElements_partSize', 'responseElements_codeSha256', 'requestParameters_iam_serviceName', 'responseElements_restapiDeployments_restApiId', 'requestParameters_dynamodb_limit', 'responseElements_pipeline_artifactStore_type', 'requestParameters_ec2_DescribeNatGatewaysRequest_Filter_Name', 'responseElements_groupId', 'responseElements_deploymentById_restApiId', 'responseElements_eTag', 'responseElements_basepathmappingCreate_template', 'responseElements_methodIntegration_passthroughBehavior', 'responseElements_CreateNatGatewayResponse_xmlns', 'responseElements_documentationpartDelete_restApiId', '_id', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_maxTTL', 'responseElements_subnetGroupStatus', 'responseElements_userImportJob_preSignedUrl', 'responseElements_build_arn', 'responseElements_self_domainName', 'responseElements_vpnConnection_vpnConnectionId', 'requestParameters_kms_encryptionContext_aws:lambda:FunctionArn', 'responseElements_build_environment_image', 'responseElements_preferredBackupWindow', 'requestParameters_sts_durationSeconds', 'responseElements_project_serviceRole', 'responseElements_mailFromDomainAttributes_adriang@spaceflightindustries\\u002ecom_behaviorOnMXFailure', 'responseElements_environment_variables_HookUrl', 'requestParameters_elasticmapreduce_instances_emrManagedSlaveSecurityGroup', 'responseElements_subnet_availabilityZone', 'requestParameters_cognito-identity_identityPoolName', 'responseElements_environment_variables_bower_storage__registry', 'requestParameters_lambda_environment_variables_ES_INDEX_PREFIX', 'responseElements_changeInfo_status', 'responseElements_healthCheck_target', 'requestParameters_waf-regional_byteMatchSetId', 'requestParameters_lambda_s3Bucket', 'requestParameters_cloudtrail_endTime', 'responseElements_attachment_state', 'requestParameters_ecs_role', 'responseElements_sizeConstraintSet_name', 'requestParameters_lambda_statementId', 'responseElements_group_groupId', 'responseElements_accountUsage_functionCount', 'responseElements_uri', 'responseElements_tableDescription_tableName', 'requestParameters_apigateway_keyId', 'userIdentity_sessionContext_attributes_creationDate', 'requestParameters_lambda_includePreviewFeatures', 'requestParameters_ecs_deploymentConfiguration_maximumPercent', 'responseElements_cacheParameterGroup_parameterApplyStatus', 'responseElements_dBSubnetGroupArn', 'requestParameters_cloudfront_maxItems', 'responseElements_loadBalancerName', 'responseElements_availabilityZone', 'requestParameters_ecr_registryId', 'requestParameters_s3_NotificationConfiguration_QueueConfiguration_Filter_S3Key_FilterRule_Value', 'responseElements_location_type', 'responseElements_self_documentationPartId', 'responseElements_task_group', 'responseElements_role_roleName', 'responseElements_service_createdAt', 'requestParameters_elasticloadbalancing_priority', 'responseElements_enabled', 'responseElements_resourceById_template', 'requestParameters_lambda_maxItems', 'responseElements_methodresponsePut_template', 'requestParameters_ssm_name', 'requestParameters_autoscaling_maxRecords', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_requesterPeeringConnectionOptions_allowEgressFromLocalClassicLinkToRemoteVpc', 'requestParameters_ec2_enableDnsHostnames_value', 'responseElements_resourceUpdate_restApiId', 'eventType', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_requestId', 'responseElements_accessKey_userName', 'responseElements_activity_startTime', 'requestParameters_ecr_nextToken', 'responseElements_responseTemplates_application/json', 'requestParameters_ec2_groupDescription', 'responseElements_environment_variables_bower_directory', 'responseElements_result', 'requestParameters_ecs_service', 'responseElements_integrationDelete_restApiId', 'responseElements_cacheClusterCreateTime', 'responseElements_integrationResponses_200_self_httpMethod', 'responseElements_project_webhook_url', 'requestParameters_apigateway_putIntegrationResponseInput_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Headers', 'responseElements_userPool_lambdaConfig_customMessage', 'requestParameters_apigateway_putIntegrationInput_passthroughBehavior', 'requestParameters_cognito-idp_lambdaConfig_createAuthChallenge', 'requestParameters_ecr_partLastByte', 'responseElements_identityPoolId', 'responseElements_restapiResources_template', 'requestParameters_route53_callerReference', 'responseElements_task_lastStatus', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_maxTTL', 'requestParameters_elasticmapreduce_applicationAttemptId', 'requestParameters_apigateway_createBasePathMappingInput_stage', 'requestParameters_elasticloadbalancing_loadBalancerAttributes_connectionDraining_timeout', 'requestParameters_sns_name', 'responseElements_loadBalancerAttributes_connectionDraining_timeout', 'requestParameters_route53_recordType', 'requestParameters_elasticloadbalancing_ruleArn', 'requestParameters_iam_policyArn', 'requestParameters_ec2_description', 'responseElements_usageplanUsageplankeys_usagePlanId', 'responseElements_methodResponses_200_methodresponseDelete_statusCode', 'responseElements_iPSet_name', 'responseElements_userPool_mfaConfiguration', 'requestParameters_ec2_egress', 'responseElements_accessKey_createDate', 'responseElements_project_source_auth_type', 'requestParameters_monitoring_nextToken', 'responseElements_repository_repositoryName', 'responseElements_methodIntegration_integrationUpdate_restApiId', 'requestParameters_ec2_endTime', 'responseElements_schemaArn', 'responseElements_accessKey_status', 'requestParameters_kinesis_tags_Environment', 'responseElements_instanceCreateTime', 'responseElements_methodDelete_httpMethod', 'requestParameters_route53_changeBatch_comment', 'requestParameters_cognito-idp_emailVerificationMessage', 'responseElements_service_clusterArn', 'responseElements_project_environment_type', 'responseElements_timeoutInMillis', 'responseElements_passthroughBehavior', 'responseElements_numCacheNodes', 'responseElements_credentials_accessKeyId', 'requestParameters_rds_maxRecords', 'requestParameters_cloudfront_distributionConfig_viewerCertificate_certificateSource', 'requestParameters_datapipeline_name', 'requestParameters_monitoring_period', 'requestParameters_ecs_containerInstance', 'responseElements_authorizerUpdate_authorizerId', 'requestParameters_cognito-idp_lambdaConfig_preAuthentication', 'responseElements_basePath', 'responseElements_cacheNamespace', 'requestParameters_apigateway_createBasePathMappingInput_restApiId', 'responseElements_rule_name', 'requestParameters_cloudformation_nextToken', 'responseElements_userPool_lastModifiedDate', 'requestParameters_config_configRule_configRuleState', 'requestParameters_ec2_DescribeHostsRequest_Filter_tag', 'responseElements_routeTable_routeTableId', 'responseElements_userPool_policies_passwordPolicy_requireNumbers', 'responseElements_throttleSettings_rateLimit', 'responseElements_appliedSchemaArn', 'responseElements_ruleArn', 'requestParameters_apigateway_parameters_mode', 'requestParameters_ec2_DescribeInstanceCreditSpecificationsRequest_InstanceId_content', 'responseElements_dBInstanceIdentifier', 'requestParameters_sns_authenticateOnUnsubscribe', 'responseElements_restapiModels_restApiId', 'requestParameters_support_displayId', 'requestParameters_cloudfront_distributionConfig_origins_quantity', 'requestParameters_waf-regional_metricName', 'requestParameters_apigateway_createAuthorizerInput_authorizerUri', 'requestParameters_dynamodb_tableName', 'requestParameters_lambda_s3Key', 'requestParameters_kms_encryptionContext_aws:codecommit:id', 'responseElements_domain', 'responseElements_newAssociationId', 'requestParameters_ec2_cidrBlock', 'requestParameters_lambda_environment_variables_slackChannel', 'responseElements_subnet_availableIpAddressCount', 'responseElements_distribution_distributionConfig_aliases_quantity', 'responseElements_cacheClusterId', 'requestParameters_kinesis_shardCount', 'requestParameters_rds_applyImmediately', 'requestParameters_config_configRule_configRuleName', 'responseElements_distribution_domainName', 'requestParameters_lambda_masterRegion', 'responseElements_documentationpartCreate_createDocumentationPartInput_location_path', 'additionalEventData_SwitchTo', 'requestParameters_cognito-idp_cSS', 'requestParameters_elasticloadbalancing_type', 'requestParameters_ec2_ModifyVpcPeeringConnectionOptionsRequest_VpcPeeringConnectionId', 'requestParameters_s3_AccessControlPolicy_Owner_ID', 'responseElements_keyMetadata_keyUsage', 'requestParameters_logs_logGroupNamePrefix', 'responseElements_repositoryMetadata_repositoryName', 'responseElements_authorizerResultTtlInSeconds', 'responseElements_userPool_deviceConfiguration_deviceOnlyRememberedOnUserPrompt', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_allowedMethods_quantity', 'requestParameters_config_configurationRecorder_recordingGroup_allSupported', 'requestParameters_sqs_attribute_VisibilityTimeout', 'requestParameters_config_nextToken', 'responseElements_methodSettings_*/*_loggingLevel', 'responseElements_build_artifacts_location', 'responseElements_vpcPeeringConnection_expirationTime', 'responseElements_stageByName_restApiId', 'responseElements_loginProfile_createDate', 'requestParameters_s3_bucketPolicy_Id', 'requestParameters_codepipeline_name', 'readOnly', 'requestParameters_ecr_uploadId', 'userIdentity_accountId', 'requestParameters_monitoring_unit', 'responseElements_methodresponseDelete_restApiId', 'responseElements_CreateNatGatewayResponse_natGateway_natGatewayAddressSet_item_allocationId', 'responseElements_build_projectName', 'responseElements_self_restApiId', 'requestParameters_ec2_clientToken', 'requestParameters_ecs_clientToken', 'responseElements_distribution_distributionConfig_isIPV6Enabled', 'responseElements_userPool_creationDate', 'additionalEventData_MfaType', 'responseElements_activity_activityId', 'responseElements_methodIntegration_integrationUpdate_httpMethod', 'responseElements_vpnConnection_state', 'requestParameters_apigateway_putIntegrationResponseInput_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Methods', 'responseElements_taskDefinition_taskRoleArn', 'responseElements_requestvalidatorById_restApiId', 'responseElements_integrationresponseDelete_resourceId', 'responseElements_responseModels_image/png', 'responseElements_userPoolClient_lastModifiedDate', 'responseElements_project_lastModified', 'responseElements_layerDigest', 'requestParameters_autoscaling_associatePublicIpAddress', 'responseElements_queueUrl', 'responseElements_project_artifacts_type', 'responseElements_environment_variables_POOLID', 'requestParameters_ec2_cidrIp', 'responseElements_deploymentCreate_restApiId', 'responseElements_userPoolUIConfiguration_details_ALL_image-bucket', 'responseElements_instanceProfile_instanceProfileName', 'requestParameters_iam_policyName', 'requestParameters_cloudtrail_s3BucketName', 'requestParameters_autoscaling_scalingAdjustment', 'responseElements_integrationResponses_200_integrationresponseDelete_restApiId', 'responseElements_instanceProfile_path', 'responseElements_tags_lambda-console:blueprint', 'requestParameters_monitoring_namespace', 'requestParameters_apigateway_createBasePathMappingInput_basePath', 'responseElements_userPoolUIConfiguration_details_ALL_font-color', 'responseElements_methodIntegration_integrationDelete_resourceId', 'responseElements_customerGateway_state', 'responseElements_methodResponses_200_methodresponseDelete_resourceId', 'additionalEventData_vpcEndpointId', 'responseElements_timeout', 'responseElements_gatewayresponsePut_restApiId', 'responseElements_description', 'responseElements_invalidation_invalidationBatch_paths_quantity', 'requestParameters_cognito-idp_lambdaConfig_postAuthentication', 'requestParameters_route53_vPC_vPCRegion', 'requestParameters_sns_token', 'responseElements_vpcId', 'responseElements_objectIdentifier', 'requestParameters_s3_AccessControlPolicy_AccessControlList_Grant_Grantee_xmlns:xsi', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseDelete_statusCode', 'responseElements_methodIntegration_integrationResponses_200_self_restApiId', 'requestParameters_monitoring_maxRecords', 'requestParameters_elasticmapreduce_instances_serviceAccessSecurityGroup', 'responseElements_methodResponses_200_statusCode', 'responseElements_customerGateway_customerGatewayId', 'requestParameters_cognito-idp_policies_passwordPolicy_requireUppercase', 'requestParameters_iam_description', 'requestParameters_support_caseId', 'responseElements_methodresponseUpdate_resourceId', 'requestParameters_cloudtrail_maxResults', 'requestParameters_ec2_instanceType', 'requestParameters_codepipeline_reason', 'requestParameters_cloudfront_distributionConfig_aliases_quantity', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_forwardedValues_queryString', 'responseElements_integrationUpdate_resourceId', 'responseElements_subnet_cidrBlock', 'responseElements_documentationpartCreate_createDocumentationPartInput_location_statusCode', 'responseElements_pipelineExecution_pipelineName', 'requestParameters_rds_finalDBSnapshotIdentifier', 'requestParameters_elasticmapreduce_instances_ec2SubnetId', 'responseElements_apiKeyRequired', 'responseElements_pipelineExecution_pipelineExecutionId', 'requestParameters_waf_webACLId', 'responseElements_CreateNatGatewayResponse_natGateway_natGatewayId', 'responseElements_distribution_distributionConfig_customErrorResponses_quantity', 'requestParameters_config_laterTime', 'requestParameters_lambda_environment_variables_ROOT_PATH', 'requestParameters_config_deliveryChannel_snsTopicARN', 'responseElements_repository_createdAt', 'requestParameters_cognito-idp_deviceConfiguration_deviceOnlyRememberedOnUserPrompt', 'requestParameters_monitoring_actionsEnabled', 'responseElements_handler', 'requestParameters_cognito-idp_policies_passwordPolicy_requireNumbers', 'requestParameters_elasticloadbalancing_healthCheck_unhealthyThreshold', 'responseElements_project_environment_computeType', 'responseElements_documentationpartImport_template', 'requestParameters_config_configRule_source_sourceIdentifier', 'requestParameters_iam_assignmentStatus', 'eventTime', 'responseElements_task_containerInstanceArn', 'requestParameters_sqs_attributes_Policy', 'requestParameters_elasticloadbalancing_loadBalancerPort', 'responseElements_methodResponses_200_responseModels_image/png', 'responseElements_healthCheck_timeout', 'responseElements_self_deploymentId', 'responseElements_restapiResources_restApiId', 'requestParameters_kinesis_limit', 'responseElements_tableDescription_provisionedThroughput_writeCapacityUnits', 'responseElements_policy_isAttachable', 'responseElements_certificateArn', 'responseElements_userPoolClient_userPoolId', 'responseElements_authorizerDelete_authorizerId', 'responseElements_methodUpdate_restApiId', 'responseElements_project_timeoutInMinutes', 'requestParameters_kms_aliasName', 'requestParameters_cognito-idp_smsAuthenticationMessage', 'responseElements_authorizerById_template', 'requestParameters_apigateway_mode', 'requestParameters_logs_orderBy', 'responseElements_distribution_status', 'requestParameters_cognito-idp_imageFile_mark', 'responseElements_methodIntegration_requestParameters_integration\\u002erequest\\u002epath\\u002eproxy', 'requestParameters_cognito-identity_roles_unauthenticated', 'responseElements_authorizerById_restApiId', 'requestParameters_kms_encryptionContext_aws:codecommit:sig-alg', 'requestParameters_athena_queryExecutionId', 'responseElements_tableDescription_tableStatus', 'requestParameters_iam_policyDocument', 'requestParameters_lambda_timeout', 'responseElements_userPoolClient_clientName', 'requestParameters_s3_bucketPolicy_Version', 'responseElements_environment_variables_bower_cwd', 'responseElements_location', 'requestParameters_ec2_aclProtocol', 'responseElements_policy_createDate', 'requestParameters_cognito-idp_details_font-color', 'requestParameters_s3_WebsiteConfiguration_IndexDocument_Suffix', 'requestParameters_glue_schemaChangePolicy_updateBehavior', 'requestParameters_rds_masterUsername', 'requestParameters_lambda_sourceArn', 'requestParameters_glacier_accountId', 'requestParameters_support_categoryCode', 'requestParameters_rds_duration', 'responseElements_distribution_id', 'responseElements_authorizationType', 'requestParameters_lambda_environment_variables_bower_cwd', 'requestParameters_autoscaling_iamInstanceProfile', 'responseElements_credentials_sessionToken', 'responseElements_role_description', 'responseElements_reservationId', 'requestParameters_datapipeline_sphere', 'responseElements_backupRetentionPeriod', 'responseElements_parentId', 'requestParameters_codepipeline_pipelineExecutionId', 'responseElements_repositoryMetadata_accountId', 'requestParameters_waf-regional_iPSetId', 'requestParameters_rds_defaultOnly', 'requestParameters_iam_assumeRolePolicyDocument', 'requestParameters_cognito-idp_lambdaConfig_postConfirmation', 'requestParameters_config_configRule_source_owner', 'responseElements_domainnameDelete_domainName', 'requestParameters_acm_idempotencyToken', 'requestParameters_ec2_DescribeVolumesModificationsRequest_MaxResults', 'requestParameters_lambda_tags_lambda-console:blueprint', 'requestParameters_cloudformation_changeSetName', 'responseElements_resourceCreate_parentId', 'requestParameters_apigateway_putIntegrationInput_type', 'responseElements_vpnConnection_category', 'requestParameters_cognito-idp_lambdaConfig_verifyAuthChallengeResponse', 'requestParameters_logs_descending', 'requestParameters_monitoring_evaluationPeriods', 'requestParameters_elasticache_aZMode', 'responseElements_lastByteReceived', 'requestParameters_config_deliveryChannel_configSnapshotDeliveryProperties_deliveryFrequency', 'responseElements_attachment_vpcId', 'responseElements_methodSettings_*/*_throttlingBurstLimit', 'responseElements_task_cpu', 'responseElements_endpointAddress', 'responseElements_subnet_state', 'responseElements_accountLimit_concurrentExecutions', 'requestParameters_events_expression', 'responseElements_vpcPeeringConnection_accepterVpcInfo_cidrBlock', 'requestParameters_autoscaling_imageId', 'responseElements_cacheClusterSize', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_forwardedValues_queryString', 'requestParameters_s3_NotificationConfiguration_CloudFunctionConfiguration_Event', 'responseElements_loadBalancerAttributes_connectionDraining_enabled', 'responseElements_deploymentById_template', 'requestParameters_apigateway_createUsagePlanKeyInput_keyType', 'requestParameters_sts_roleArn', 'requestParameters_route53domains_createdSince', 'responseElements_userImportJob_cloudWatchLogsRoleArn', 'responseElements_usageGet_endDate', 'requestParameters_cognito-idp_policies_passwordPolicy_minimumLength', 'requestParameters_elasticmapreduce_instances_keepJobFlowAliveWhenNoSteps', 'responseElements_topicArn', 'responseElements_integrationUpdate_httpMethod', 'responseElements_tableDescription_itemCount', 'responseElements_policyText', 'requestParameters_logs_filterNamePrefix', 'responseElements_distribution_distributionConfig_logging_prefix', 'requestParameters_elasticmapreduce_scaleDownBehavior', 'requestParameters_codepipeline_retryMode', 'requestParameters_cloudformation_logicalResourceId', 'requestParameters_codecommit_repositoryName', 'requestParameters_iam_groupName', 'requestParameters_cloudformation_templateURL', 'requestParameters_lambda_description', 'responseElements_group_createDate', 'responseElements_requestvalidatorCreate_restApiId', 'responseElements_self_statusCode', 'requestParameters_events_rule', 'responseElements_user_userName', 'requestParameters_lambda_environment_variables_REGION', 'requestParameters_cloudfront_distributionId', 'responseElements_methodSettings_*/*_unauthorizedCacheControlHeaderStrategy', 'requestParameters_ec2_name', 'requestParameters_ses_policy', 'responseElements_policy_arn', 'responseElements_certificateUploadDate', 'requestParameters_rds_tdeCredentialPassword', 'responseElements_engine', 'responseElements_build_currentPhase', 'requestParameters_elasticbeanstalk_includeDeleted', 'responseElements_integrationresponseDelete_httpMethod', 'responseElements_memorySize', 'requestParameters_cloudfront_webACLId', 'requestParameters_ec2_DescribeNatGatewaysRequest_Filter_tag', 'requestParameters_dynamodb_provisionedThroughput_readCapacityUnits', 'requestParameters_s3_AccessControlPolicy_AccessControlList_Grant_Grantee_ID', 'responseElements_properties', 'responseElements_methodresponsePut_restApiId', 'responseElements_repository_repositoryUri', 'requestParameters_ec2_keyName', 'requestParameters_apigateway_httpMethod', 'requestParameters_athena_queryExecutionContext_database', 'responseElements_SwitchRole', 'responseElements_uICustomization_userPoolId', 'responseElements_methodIntegration_type', 'requestParameters_lambda_action', 'responseElements_usageplankeyDelete_usagePlanId', 'responseElements_distribution_distributionConfig_viewerCertificate_certificateSource', 'responseElements_documentationpartById_template', 'requestParameters_cloudtrail_includeShadowTrails', 'requestParameters_events_scheduleExpression', 'responseElements_userPoolUIConfiguration_userPoolId', 'requestParameters_sqs_attribute_DelaySeconds', 'responseElements_integrationresponsePut_restApiId', 'responseElements_repositoryMetadata_arn', 'requestParameters_s3_ReplicationConfiguration_Rule_Destination_Bucket', 'responseElements_expiryTime', 'responseElements_requestTemplates_application/json', 'responseElements__return', 'requestParameters_cognito-idp_lambdaConfig_preSignUp', 'responseElements_task_stoppingAt', 'responseElements_project_source_buildspec', 'additionalEventData_LoginTo', 'requestParameters_cognito-identity_roles_authenticated', 'responseElements_self_httpMethod', 'requestParameters_autoscaling_shouldDecrementDesiredCapacity', 'requestParameters_rds_vpc', 'responseElements_methodIntegration_cacheNamespace', 'recipientAccountId', 'requestParameters_lambda_environment_variables_LOG_LEVEL', 'responseElements_self_usagePlanId', 'requestParameters_apigateway_deploymentId', 'responseElements_healthCheck_unhealthyThreshold', 'requestParameters_apigateway_putMethodInput_apiKeyRequired', 'requestParameters_cloudfront_distributionConfig_callerReference', 'responseElements_preferredAvailabilityZone', 'requestParameters_ec2_type', 'requestParameters_cloudformation_physicalResourceId', 'requestParameters_codebuild_awsActId', 'requestParameters_sqs_attributes_MessageRetentionPeriod', 'responseElements_webhook_url', 'requestParameters_autoscaling_instanceType', 'requestParameters_sqs_attribute_RedrivePolicy', 'requestParameters_apigateway_createDocumentationPartInput_location_path', 'responseElements_image_registryId', 'responseElements_deploymentId', 'responseElements_resourceUpdate_resourceId', 'requestParameters_events_targetArn', 'responseElements_distribution_aRN', 'requestParameters_route53_resourceId', 'requestParameters_athena_resultConfiguration_outputLocation', 'responseElements_sqlInjectionMatchSet_sqlInjectionMatchSetId', 'responseElements_hostedZone_name', 'sharedEventID', 'responseElements_activity_cause', 'requestParameters_elasticloadbalancing_listenerArn', 'responseElements_resourceDelete_restApiId', 'requestParameters_cognito-idp_generateSecret', 'responseElements_activity_description', 'requestParameters_ec2_ruleNumber', 'responseElements_invalidation_status', 'responseElements_service_serviceName', 'responseElements_webACL_defaultAction_type', 'requestParameters_ecs_desiredCount', 'requestParameters_cloudfront_distributionConfig_httpVersion', 'requestParameters_autoscaling_healthCheckType', 'responseElements_methodIntegration_self_httpMethod', 'requestParameters_rds_dBSubnetGroupName', 'responseElements_repositoryMetadata_lastModifiedDate', 'requestParameters_autoscaling_stepScalingPolicyConfiguration_cooldown', 'responseElements_distribution_distributionConfig_viewerCertificate_cloudFrontDefaultCertificate', 'requestParameters_route53_name', 'responseElements_keyMetadata_keyState', 'responseElements_restapiStages_restApiId', 'requestParameters_cognito-idp_userPoolId', 'requestParameters_elasticache_cacheClusterId', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_compress', 'responseElements_tracingConfig_mode', 'requestParameters_s3_ReplicationConfiguration_Rule_ID', 'responseElements_tableDescription_tableArn', 'requestParameters_cognito-idp_allowedOAuthFlowsUserPoolClient', 'requestParameters_cognito-idp_adminCreateUserConfig_inviteMessageTemplate_emailSubject', 'requestParameters_route53domains_maxItems', 'responseElements_ownerId', 'requestParameters_waf-regional_defaultAction_type', 'requestParameters_cloudfront_distributionConfig_logging_enabled', 'responseElements_userPool_emailConfiguration_sourceArn', 'responseElements_build_source_buildspec', 'requestParameters_apigateway_authorizerId', 'responseElements_user_arn', 'requestParameters_ecs_task', 'requestParameters_s3_NotificationConfiguration_QueueConfiguration_Id', 'responseElements_publicIp', 'responseElements_distribution_distributionConfig_defaultCacheBehavior_forwardedValues_headers_quantity', 'requestParameters_rds_masterUserPassword', 'responseElements_keyMetadata_description', 'responseElements_methodresponseUpdate_statusCode', 'requestParameters_codepipeline_version', 'requestParameters_autoscaling_forceDelete', 'responseElements_stage', 'requestParameters_logs_nextToken', 'responseElements_hostedZone_callerReference', 'responseElements_documentationpartCreate_restApiId', 'responseElements_tableDescription_provisionedThroughput_numberOfDecreasesToday', 'requestParameters_athena_queryString', 'responseElements_environment_variables_SERVICE', 'responseElements_cacheNodeType', 'requestParameters_rds_dBName', 'requestParameters_elasticache_numCacheNodes', 'responseElements_task_taskDefinitionArn', 'responseElements_domainnameUpdate_domainName', 'responseElements_methodByHttpMethod_template', 'responseElements_httpMethod', 'responseElements_policy_defaultVersionId', 'requestParameters_datapipeline_pipelineId', 'requestParameters_cognito-idp_adminCreateUserConfig_inviteMessageTemplate_emailMessage', 'requestParameters_apigateway_createAuthorizerInput_authorizerResultTtlInSeconds', 'responseElements_policy_description', 'responseElements_integrationDelete_resourceId', 'responseElements_functionName', 'requestParameters_apigateway_body_capacity', 'requestParameters_sqs_attributes_MaximumMessageSize', 'responseElements_dBSubnetGroupDescription', 'responseElements_environment_variables_ORG', 'responseElements_mailFromDomainAttributes_dev\\u002eblacksky\\u002ecom_behaviorOnMXFailure', 'requestParameters_rds_description', 'requestParameters_ec2_ruleAction', 'requestParameters_elasticloadbalancing_vpcId', 'responseElements_integrationResponses_200_self_title', 'requestParameters_ecr_policyText', 'requestParameters_rds_dBInstanceClass', 'responseElements_mailFromDomainAttributes_admin-ordering@spaceflightindustries\\u002ecom_behaviorOnMXFailure', 'eventSource', 'requestParameters_codecommit_order', 'responseElements_latestRestorableTime', 'responseElements_grantId', 'requestParameters_lambda_environment_variables_ORG', 'requestParameters_elasticmapreduce_instances_emrManagedMasterSecurityGroup', 'responseElements_verificationToken', 'requestParameters_sns_topicArn', 'responseElements_deploymentStages_restApiId', 'requestParameters_kms_keyUsage', 'requestParameters_ecs_taskRoleArn', 'responseElements_role', 'responseElements_documentationpartUpdate_documentationPartId', 'requestParameters_autoscaling_minCapacity', 'requestParameters_cognito-idp_verificationMessageTemplate_defaultEmailOption', 'requestParameters_lambda_environment_variables_URL', 'requestParameters_apigateway_createRestApiInput_name', 'requestParameters_kms_destinationEncryptionContext_aws:elasticloadbalancing:arn', 'requestParameters_directconnect_maxResults', 'requestParameters_s3_NotificationConfiguration_TopicConfiguration_Event', 'requestParameters_support_maxResults', 'responseElements_build_endTime', 'additionalEventData_MFAUsed', 'responseElements_allocatedStorage', 'requestParameters_elasticmapreduce_instances_ec2KeyName', 'responseElements_value', 'responseElements_service_roleArn', 'responseElements_integrationResponses_200_self_statusCode', 'requestParameters_ec2_vpcPeeringConnectionId', 'requestParameters_elasticloadbalancing_scheme', 'requestParameters_ec2_vpcId', 'requestParameters_autoscaling_cooldown', 'requestParameters_kms_encryptionContext_aws:codecommit:env-alg', 'requestParameters_kms_sourceEncryptionContext_aws:acm:arn', 'requestParameters_kms_limit', 'requestParameters_kms_destinationAAD', 'requestParameters_rds_dBSubnetGroupDescription', 'responseElements_uICustomization_cSSVersion', 'eventID', 'requestParameters_elasticloadbalancing_loadBalancerAttributes_crossZoneLoadBalancing_enabled', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_requesterPeeringConnectionOptions_allowEgressFromLocalVpcToRemoteClassicLink', 'requestParameters_ec2_ipAddress', 'requestParameters_ec2_DescribeHostsRequest_maxResults', 'responseElements_modelCreate_createModelInput_contentType', 'responseElements_project_arn', 'requestParameters_lambda_sourceAccount', 'additionalEventData_Note', 'responseElements_url', 'requestParameters_apigateway_putIntegrationResponseInput_responseParameters_method\\u002eresponse\\u002eheader\\u002eAccess-Control-Allow-Origin', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_accepterPeeringConnectionOptions_allowEgressFromLocalClassicLinkToRemoteVpc', 'requestParameters_firehose_limit', 'responseElements_resourceCreate_restApiId', 'requestParameters_waf_timeWindow_endTime', 'requestParameters_lambda_environment_variables_bower_storage__packages', 'responseElements_project_artifacts_namespaceType', 'responseElements_name', 'requestParameters_support_includeCommunications', 'responseElements_build_timeoutInMinutes', 'responseElements_project_environment_image', 'responseElements_ModifyVpcPeeringConnectionOptionsResponse_accepterPeeringConnectionOptions_allowEgressFromLocalVpcToRemoteClassicLink', 'requestParameters_elasticmapreduce_sourceId', 'responseElements_accountLimit_codeSizeZipped', 'responseElements_userPoolUIConfiguration_details_ALL_background-color', 'responseElements_usageplankeyCreate_usagePlanId', 'additionalEventData_MobileVersion', 'requestParameters_ses_notificationType', 'responseElements_vpc_state', 'requestParameters_ec2_includeAllInstances', 'requestParameters_apigateway_createUsagePlanInput_name', 'responseElements_integrationresponsePut_httpMethod', 'responseElements_keyMetadata_keyManager', 'responseElements_service_pendingCount', 'requestParameters_lambda_environment_variables_DYNAMODB_PREFIX', 'responseElements_image_imageId_imageDigest', 'requestParameters_rds_includeShared', 'requestParameters_s3_VersioningConfiguration_Status', 'requestParameters_es_instanceType', 'responseElements_cacheSubnetGroupName', 'responseElements_methodPut_resourceId', 'requestParameters_lambda_role', 'requestParameters_config_configurationRecorderName', 'responseElements_distribution_distributionConfig_logging_bucket', 'requestParameters_clouddirectory_version', 'requestParameters_ec2_ipProtocol', 'responseElements_methodByHttpMethod_resourceId', 'responseElements_vpc_dhcpOptionsId', 'responseElements_methodIntegration_integrationResponses_200_self_resourceId', 'requestParameters_apigateway_usagePlanId', 'requestParameters_apigateway_restApiId', 'requestParameters_sts_roleSessionName', 'requestParameters_autoscaling_desiredCapacity', 'responseElements_endpoint_hostedZoneId', 'requestParameters_cognito-idp_imageFile_bigEndian', 'responseElements_distribution_distributionConfig_callerReference', 'requestParameters_ecs_maxResults', 'requestParameters_kms_sourceAAD', 'requestParameters_kms_policy', 'responseElements_authorizerDelete_restApiId', 'responseElements_dBParameterGroupName', 'responseElements_authorizerCreate_restApiId', 'requestParameters_health_maxResults', 'requestParameters_ec2_ModifyVpcPeeringConnectionOptionsRequest_AccepterPeeringConnectionOptions_AllowDnsResolutionFromRemoteVpc', 'requestParameters_autoscaling_instanceMonitoring_enabled', 'responseElements_configSnapshotId', 'responseElements_environment_variables_URL', 'requestParameters_elasticmapreduce_serviceRole', 'requestParameters_rds_autoMinorVersionUpgrade', 'responseElements_restapiAuthorizers_restApiId', 'requestParameters_waf_limit', 'requestParameters_ds_limit', 'responseElements_project_artifacts_name', 'requestParameters_lambda_environment_variables_ES_HOST', 'requestParameters_s3_AccessControlPolicy_AccessControlList_Grant_Permission', 'requestParameters_cloudformation_exportName', 'responseElements_build_source_location', 'responseElements_methodIntegration_integrationResponses_200_integrationresponseUpdate_httpMethod', 'responseElements_stageByName_template', 'requestParameters_autoscaling_maxCapacity', 'requestParameters_logs_showSubscriptionDestinations', 'responseElements_xssMatchSet_xssMatchSetId', 'responseElements_restapiDocumentationVersions_restApiId', 'responseElements_integrationDelete_httpMethod', 'responseElements_dhcpOptions_dhcpOptionsId', 'requestParameters_sns_attributeValue', 'requestParameters_cognito-idp_details_image-bucket', 'responseElements_directoryArn', 'responseElements_self_basePath', 'requestParameters_ec2_CreateNatGatewayRequest_AllocationId', 'responseElements_modelByName_template', 'requestParameters_s3_LifecycleConfiguration_Rule_Status', 'requestParameters_ecr_layerDigest', 'requestParameters_cloudfront_distributionConfig_defaultCacheBehavior_defaultTTL', 'requestParameters_apigateway_putMethodInput_authorizerId', 'requestParameters_elasticloadbalancing_healthCheckTimeoutSeconds', 'requestParameters_glue_tableName', 'requestParameters_codepipeline_pipeline_roleArn', 'requestParameters_s3_AccessControlPolicy_Owner_DisplayName', 'requestParameters_s3_AccessControlPolicy_AccessControlList_Grant_Grantee_xsi:type', 'requestParameters_waf_timeWindow_startTime', 'responseElements_contentHandling', 'responseElements_CreateNatGatewayResponse_natGateway_vpcId', 'responseElements_self_keyId', 'requestParameters_iot_maxResults', 'requestParameters_waf_ruleId', 'requestParameters_rds_resourceName', 'requestParameters_cloudfront_distributionConfig_priceClass', 'requestParameters_apigateway_domainName', 'requestParameters_ec2_CreateNatGatewayRequest_ClientToken', 'requestParameters_kms_constraints_encryptionContextEquals_aws:elasticloadbalancing:arn', 'responseElements_distributionDomainName', 'requestParameters_lambda_principal', 'requestParameters_ecs_cluster', 'requestParameters_cognito-identity_identityPoolId', 'requestParameters_codepipeline_stageName', 'requestParameters_logs_destinationArn', 'responseElements_uploadId', 'requestParameters_cognito-idp_imageFile_capacity'}


class SeparatedVarianceSelector(object):
    def __init__(self, perm_universe_query, fields_to_bin=set(), add_missing_fields=False):
        self.perm_universe_query = perm_universe_query
        self.fields_to_bin = fields_to_bin #{'eventTime', 'eventName', 'sourceIPAddress', 'userIdentity_accessKeyId', 'userAgent'}
        self.valid_keys = set()
        self.event_normalizer = ConfigurableEventNormalizerNg(use_resources=False, bin_method='eqf-6', fields_to_bin=self.fields_to_bin, valid_keys=self.valid_keys, add_missing_fields=add_missing_fields)

    def calculate_variance(self, instance_sample_rate, fields_to_skip=set(), fields_to_bin=set(), filter_key=None, filter_ceiling=1.1, filter_floor=-1.0):
        if fields_to_skip and fields_to_bin:
            fields_to_skip = fields_to_skip.difference(fields_to_bin)

        event_values = {}
        total_event_count = 0
        for event in events_collection.find(self.perm_universe_query):
            if random.uniform(0, 1) > instance_sample_rate:
                continue
            flat_event = self.event_normalizer.normalized_user_op_resource_from_event(event)
            for key, value in flat_event.items():
                if key in fields_to_skip:
                    continue
                if key not in event_values:
                    event_values[key] = []
                event_values[key].append(value)
            total_event_count += 1
            if total_event_count % 50000 == 0:
                print('%d events...' % total_event_count)

        results = {}
        field_instance_counter = Counter()
        for key, value in event_values.items():
            if key in fields_to_skip:
                continue
            field_instance_counter.update([key])
            # print('Calculating variance for %s' % key)
            vectorizor = DictVectorizer(sparse=False)
            normed_events = []
            for v in value:
                normed_events.append({key: v})
            # X = vectorizor.fit_transform(normed_events)
            # selector = VarianceThreshold(0.0)
            unique_value_count = len(set(event_values[key]))
            e_v_2 = [s for s in event_values[key] if s is not 'NONE']
            instances = len(e_v_2)#len(event_values[key])
            frequency = instances / total_event_count
            if instances > 0:
                uniqueness = 1-(unique_value_count / instances)
            else:
                uniqueness = 0
            try:
                # result = selector.fit_transform(X)
                # variances = selector.variances_
                total_of_variances = 0
                # for variance in variances:
                #     total_of_variances += variance
                key_weight = 0 #(total_of_variances) * frequency
                vf_score = 0 # (total_of_variances) * frequency
                ivf_score = 0 #(1-total_of_variances) * frequency
                uf_score = uniqueness * frequency
                iuf_score = (1-uniqueness) * frequency
                hkey_weight = 0 #(2 * key_weight) / (total_of_variances + frequency)
                results[key] = {'variance': total_of_variances, 'instances': instances, 'frequency': frequency, 'key_weight': key_weight, 'hkey_weight': hkey_weight, 'vf_score':vf_score, 'ivf_score':ivf_score, 'uf_score': uf_score, 'iuf_score':iuf_score}
                # print('%s: total: %f, instances: %d' % (key, total_of_variances, instances))
            except ValueError:
                # hkey_weight = (2 * frequency) / (frequency)
                results[key] = {'variance': 0.0, 'instances': instances,'frequency': frequency, 'key_weight': 0.0, 'hkey_weight': 0, 'vf_score':0, 'ivf_score':0, 'uf_score':0, 'iuf_score':0}
                # print('%s: total: %f, instances: %d' % (key, 0.0, instances))

        print()
        print('==============')
        print('fieldName, variance, values, instances, frequency, vf_score, ivf_score, uf_score, iuf_score')
        valid_keys = set()
        over_variance_keys = set()
        under_variance_keys = set()
        under_frequency_keys = set()
        for key, value in sorted(results.items(), key=lambda x:x[1][filter_key], reverse=True):
            # if filter_key == 'variance' and value['frequency'] < 0.90:
            #     continue
            if filter_key and value[filter_key] >= filter_ceiling:
                if filter_key == 'variance' and value['frequency'] < 0.90:  # When using variance, only filter out keys that are always present in the events
                    valid_keys.add(key)
                else:
                    fields_to_skip.add(key)
            elif filter_key and value[filter_key] <= filter_floor:
                fields_to_skip.add(key)
            else:
                valid_keys.add(key)
            print('%s, %f, %d, %d, %f, %f, %f, %f, %f' % (key, value['variance'], len(set(event_values[key])), value['instances'], value['frequency'], value['vf_score'], value['ivf_score'], value['uf_score'], value['iuf_score'])) #, value['hkey_weight']))
        # print('Over variance keys (%d): %s' % (len(over_variance_keys), over_variance_keys))
        # print('Under variance keys (%d): %s' % (len(under_variance_keys), under_variance_keys))
        # print('Under frequency keys (%d): %s' % (len(under_frequency_keys), under_frequency_keys))
        print('Keys to skip (%d): %s' % (len(fields_to_skip), fields_to_skip))
        print('Valid keys (%d): %s' % (len(valid_keys), valid_keys))
        return valid_keys, fields_to_skip

    def print_normd_events_csv(self, instance_sample_rate, valid_keys, fields_to_bin, correlation_threshold, add_missing_fields):
        keys_to_remove = {'eventTime_bin', 'eventTime_weekday', 'eventTime_weekend', 'eventName_bin', 'userIdentity_principalId', 'userIdentity_arn'}
        valid_keys.difference_update(keys_to_remove)
        f = open("events.csv", 'w')
        header = ', '.join([k for k in sorted(valid_keys)])
        print(header)
        f.write(header + '\n')
        for event in events_collection.find(self.job['perm_universe_query']):
            if random.uniform(0, 1) > instance_sample_rate:
                continue
            flat_event = self.event_normalizer.normalized_user_op_resource_from_event(event)
            event_line = ', '.join('{}'.format(flat_event[k]) for k in sorted(valid_keys))
            print(event_line)
            f.write(event_line + '\n')
        f.close()

    def pandas_corr_no_vect(self, record_limit, valid_keys, fields_to_bin, correlation_threshold, add_missing_fields):
        valid_events = []
        key_value_counter = Counter()
        df = pd.DataFrame()
        event_normalizer = ConfigurableEventNormalizerNg(use_resources=False, bin_method='eqf-6', fields_to_bin=fields_to_bin, valid_keys=valid_keys, add_missing_fields=add_missing_fields)

        for event in events_collection.find(self.job['perm_universe_query']):
            if len(valid_events) > record_limit:
                break
            flat_event = event_normalizer.normalized_user_op_resource_from_event(event)
            valid_events.append(flat_event)
            for k, v in flat_event.items():
                key_value_counter.update(['%s=%s' % (k, v)])
            if len(valid_events) % 50000 == 0:
                print('%d events...' % len(valid_events))
            # current_df = pd.DataFrame(flat_event, index=[0])
            # pd.concat([df, pd.DataFrame(flat_event.items())])
        total_events = len(valid_events)

        dependency_exempt_fields = {}
        # dependency_exempt_fields = {'eventTime_bin': ['eventTime_weekend', 'eventTime_weekday'],
        #                             'eventName':['eventTime_weekend', 'eventTime_weekday', 'eventTime_bin'], # 'userIdentity_invokedBy', 'userIdentity_sessionContext_attributes_mfaAuthenticated'],
        #                             'eventName_bin': ['eventTime_weekend', 'eventTime_weekday', 'eventTime_bin'], # 'userAgent_bin', 'userAgent_general_bin', 'userIdentity_invokedBy', 'userIdentity_sessionContext_attributes_mfaAuthenticated'],
        #                             'userAgent_general_bin': ['eventTime_weekend', 'eventTime_weekday', 'eventTime_bin'], #, 'sourceIPAddress_bin'],
        #                             'userIdentity_accessKeyId': ['eventTime_weekend', 'eventTime_weekday'], #, 'eventTime_bin', 'eventSource', 'sourceIPAddress_bin', 'userAgent_bin', 'userAgent_general_bin'],
        #                             'eventSource': ['eventTime_weekend', 'eventTime_weekday', 'eventTime_bin'],
        #                             'userIdentity_userName': ['eventTime_weekend', 'eventTime_weekday', 'eventTime_bin']}
        df = pd.DataFrame(valid_events)

        print('========= Correlations ===========')
        # candidate_keys = set()
        # factors_paired = [(i, j) for i in df.columns.values for j in df.columns.values]
        # correlation_matrix = np.zeros((len(df.columns.values), len(df.columns.values)))
        implied_values_counter = Counter()
        implied_values_dict = {}
        row_name_counter = {}
        for i in range(0, len(df.columns.values)):
            for j in range(len(df.columns.values)):
                row_name = df.columns.values[i]
                col_name = df.columns.values[j]
                # if (row_name == 'userAgent_bin' and col_name == 'userIdentity_invokedBy') or (row_name == 'userIdentity_invokedBy' and col_name == 'userAgent_bin'):
                #     print()
                row_series = df[row_name]
                col_series = df[col_name]
                # if col_name == 'userIdentity_invokedBy':
                #     print()
                if i == j:
                    continue
                key = '%s -> %s' % (row_name, col_name)
                try:
                    confusion_matrix = pd.crosstab(df[row_name].copy(True), df[col_name].copy(True))
                    row_name_counter[row_name] = len(confusion_matrix.index)
                    # if key == 'userIdentity_accessKeyId -> userIdentity_userName' or key == 'eventTime_weekday -> eventTime_weekend' or key == 'userAgent_bin -> eventType' or key == 'eventType -> userAgent_bin' or \
                    #                 key == 'eventType -> sourceIPAddress_bin' or key =='eventType -> eventSource' or key == 'sourceIPAddress_bin -> eventType' or key == 'eventSource -> eventName' or \
                    #                 key =='eventSource -> eventType' or key == 'eventName -> eventSource' or key == 'eventName -> eventType' or key == 'userAgent_bin -> userIdentity_invokedBy':
                    if key == 'userAgent_bin -> userIdentity_sessionContext_attributes_mfaAuthenticated' or key == 'userAgent_general_bin -> userIdentity_accessKeyId' or key == 'eventSource -> userIdentity_accessKeyId' \
                            or key == 'eventVersion -> eventType': # or key == 'userAgent_general_bin -> apiVersion' or key == 'sourceIPAddress_bin -> apiVersion':
                        print()
                        self.print_conf_table(confusion_matrix, row_name, col_name)
                        print()
                    contains_multiple_possible_values = False
                    total_key_records = 0
                    for cmi in range(0, len(confusion_matrix.values)):
                        positive_columns = 0
                        possible_column_values = set()
                        col_idx = 0
                        for cmj in range(0, len(confusion_matrix.values[cmi])):
                            if confusion_matrix.values[cmi][cmj] > 0:
                                positive_columns += 1
                                col_idx = cmj
                                possible_column_values.add(confusion_matrix.columns[cmj])
                                total_key_records += confusion_matrix.values[cmi][cmj]
                        if positive_columns > 1:
                            contains_multiple_possible_values = True
                        elif positive_columns == 1:
                            row_value = confusion_matrix.index[cmi]
                            col_value = confusion_matrix.columns[col_idx]
                            if row_name in dependency_exempt_fields.keys():
                                if len(dependency_exempt_fields[row_name]) == 0 or col_name in dependency_exempt_fields[row_name]:
                                    continue
                            # print('%s:%s -> %s:%s  support:%d' % (row_name, confusion_matrix.index[cmi], col_name, confusion_matrix.columns[col_idx], confusion_matrix.values[cmi][col_idx]))
                            implied_values_counter.update([key])
                        # if len(possible_column_values) == 1:
                            # print('%s:%s -> %s:%s ' % (row_name, confusion_matrix.index[cmi], col_name, possible_column_values))
                    implied_values_dict[key] = total_key_records
                except:
                    print('ERROR on : %s' % key)
        correlation_dict = {}
        cross_corr_dict = {}
        corr_dependency_mmap = {}
        for k, v in implied_values_counter.items():
            k1 = k.split(' -> ')[0]
            k2 = k.split(' -> ')[1]
            value_count = row_name_counter[k1]
            normd_value = v/float(value_count)
            correlation_dict[k] = {'support': v, 'normd': normd_value}
            if normd_value >= correlation_threshold:
                RuleUtils.addMulti(corr_dependency_mmap, k1, k2)
            # print('%s: support: %d normd: %f' % (k,v, v/float(value_count)))

        print('key, support, key coverage rate')
        for k, v in sorted(correlation_dict.items(), key=lambda x: x[1]['normd'], reverse=True):
            k1 = k.split(' -> ')[0]
            k2 = k.split(' -> ')[1]
            reverse_key = '%s -> %s' % (k2, k1)
            print('%s, %d, %f' % (k, v['support'], v['normd']))
            if reverse_key in correlation_dict:
                refl_key = '%s <-> %s' % (k1, k2)
                new_v = v['normd'] * correlation_dict[reverse_key]['normd']
                cross_corr_dict[refl_key] = new_v

        print('{')
        for k,v in corr_dependency_mmap.items():
            print("'%s': %s," % (k, list(v)))
        print('}')
        print('==== tsort_input ====')
        for k,v in corr_dependency_mmap.items():
            for k2 in v:
                print("%s \t %s" % (k, k2))
        # print('======= 1:1 correlations ========')
        # for k, v in sorted(cross_corr_dict.items(), key=lambda x: x[1], reverse=True):
        #     print('%s, %f' % (k, v))
        # print()

        # cc_input = {}
        # for k1 in valid_keys: cc_input[k1] = set()
        # for k1, v1 in param_dependency_mmap.items():
        #     print('%s: %s' % (k1, [v1.keys()]))
        #     for k2 in v1.keys():
        #         cc_input[k1].add(k2)
        #
        # print(self.getRoots(cc_input))
        print()

    def getRoots(self, aNeigh):
        def findRoot(aNode, aRoot):
            while aNode != aRoot[aNode][0]:
                aNode = aRoot[aNode][0]
            return (aNode, aRoot[aNode][1])

        myRoot = {}
        for myNode in aNeigh.keys():
            myRoot[myNode] = (myNode, 0)
        for myI in aNeigh:
            for myJ in aNeigh[myI]:
                (myRoot_myI, myDepthMyI) = findRoot(myI, myRoot)
                (myRoot_myJ, myDepthMyJ) = findRoot(myJ, myRoot)
                if myRoot_myI != myRoot_myJ:
                    myMin = myRoot_myI
                    myMax = myRoot_myJ
                    if myDepthMyI > myDepthMyJ:
                        myMin = myRoot_myJ
                        myMax = myRoot_myI
                    myRoot[myMax] = (myMax, max(myRoot[myMin][1] + 1, myRoot[myMax][1]))
                    myRoot[myMin] = (myRoot[myMax][0], -1)
        myToRet = {}
        for myI in aNeigh:
            if myRoot[myI][0] == myI:
                myToRet[myI] = []
        for myI in aNeigh:
            myToRet[findRoot(myI, myRoot)[0]].append(myI)
        return myToRet

    def print_conf_table(self, confusion_table, r_name, c_name):
        row_names = confusion_table.index.values
        col_names = confusion_table.columns.values
        print('%s/%s, %s' % (r_name, c_name, ", ".join(col_names)))
        for i in range(0, len(confusion_table.values)):
            row = confusion_table.values[i]
            print('%s, %s' % (row_names[i], ', '.join([str(i) for i in row])))


    def dependencies_allow_normd_event(self, current_event, param_dependency_mmap):
        for indep_key, indep_value in param_dependency_mmap.items():
            for dep_key, dep_value in indep_value.items():
                if indep_key not in current_event or dep_key not in current_event:
                    continue
                user_ind = current_event[indep_key]
                user_dep = current_event[dep_key]
                allowed_set = dep_value[user_ind]
                if user_dep not in allowed_set:
                    return False
        return True

    def set_valid_keys(self, valid_keys):
        self.valid_keys = valid_keys
        self.event_normalizer.valid_keys = valid_keys


    def generate_all_fields_list(self, perm_universe_query):
        all_fields = set()
        event_count = 0
        for event in events_collection.find(perm_universe_query):
            fields = event_flattner.flatten(event, "_")
            all_fields.update(fields)
            event_count += 1
            if event_count % 50000 == 0:
                print('%d events...' % event_count)
        return all_fields

if __name__ == "__main__":
    # perm_universe_query = job_utls.replace_query_epoch_with_datetime({"eventTime": {"$gte": {"$date": 1490054400000}, "$lte": {"$date": 1500076799000}}})
    perm_universe_query = job_utls.replace_query_epoch_with_datetime({"eventTime": {"$gte": {"$date": 0}, "$lte": {"$date": 1531180800000}}})
    selector = SeparatedVarianceSelector(perm_universe_query, {'userAgent', 'eventName'}, add_missing_fields=False)
    # all_fields = selector.generate_all_fields_list(perm_universe_query)
    print(len(all_fields))
    print(all_fields)
    valid_keys = all_fields
    fields_to_skip = set()
    selector.set_valid_keys(all_fields)
    # selector.test()

    # print('0.01-variance')
    # fields_to_skip = {'eventTime', 'eventID', 'requestID', 'userIdentity_arn', 'userIdentity_principalId', 'userIdentity_sessionContext_attributes_creationDate', 'sourceIPAddress'}
    # valid_keys, fields_to_skip = selector.calculate_variance(0.01, fields_to_skip, set(), 'variance', 0.99, 0.001)

    # valid_keys = {s for s in valid_keys if not s.startswith('requestParameters_')}

    valid_keys.update({'sourceIPAddressLocation','sourceIPAddressInternal','sourceIPAddressBin','userAgent_bin','userAgent_general_bin', 'eventName_bin', 'eventName_crud_bin'})
    # print()
    # print()
    filter = 'uf_score'
    # print('0.1-%s' % filter)
    # selector.set_valid_keys(valid_keys)
    # valid_keys, new_skip_keys = selector.calculate_variance(0.1, fields_to_skip, set(), 'vf_score', 1.1, 0.01)
    # valid_keys, new_skip_keys = selector.calculate_variance(0.1, fields_to_skip, set(), 'ivf_score', 1.1, 0.0003)
    # valid_keys, new_skip_keys = selector.calculate_variance(0.1, fields_to_skip, set(), 'uf_score', 1.1, 0.0015)

    # valid_keys, new_skip_keys = selector.calculate_variance(0.1, fields_to_skip, set(), 'vf_score', 1.1, 0.001)
    # valid_keys, new_skip_keys = selector.calculate_variance(0.1, fields_to_skip, set(), 'ivf_score', 1.1, 0.0003)
    # valid_keys, new_skip_keys = selector.calculate_variance(0.1, fields_to_skip, set(), 'uf_score', 1.1, 0.0015)
    # fields_to_skip = fields_to_skip.union(new_skip_keys)
    # print(fields_to_skip)


    # print()
    print()
    print('1.0-%s' % filter)
    selector.set_valid_keys(valid_keys)
    valid_keys, fields_to_skip = selector.calculate_variance(1.0, fields_to_skip, set(), filter, 1.1, 0.000000)
    # valid_keys, fields_to_skip = selector.calculate_variance(1.0, fields_to_skip, set(), 'ivf_score', 1.1, 0.000000)
    # valid_keys, fields_to_skip = selector.calculate_variance(1.0, fields_to_skip, set(), 'uf_score', 1.1, 0.000000)
    # print()
    # print(valid_keys)

    # valid_keys = {'sourceIPAddress','eventName','eventTime_weekday','eventTime_bin','eventSource','userIdentity_userName','eventName_bin',
    #               'userIdentity_sessionContext_attributes_mfaAuthenticated','userAgent_bin','userIdentity_invokedBy','userAgent_general_bin','eventVersion','userIdentity_accessKeyId','requestParameters_path',
    #               'requestParameters_encryptionContext_PARAMETER_ARN','sourceIPAddress_bin','requestParameters_name','requestParameters_pipelineName','eventTime_weekend','apiVersion','requestParameters_maxResults',
    #               'eventType'} #'-userIdentity_arn' '-userIdentity_principalId'

    selector.set_valid_keys({'sourceIPAddress', 'sourceIPAddress_trunc', 'sourceIPAddress_bin', 'eventName', 'eventName_crud_bin', 'eventSource', 'eventName_bin', 'userIdentity_sessionContext_attributes_mfaAuthenticated', 'userAgent', 'userAgent_bin', 'userAgent_general_bin',
                             'userIdentity_invokedBy', 'eventType', 'eventVersion', 'apiVersion', 'requestParameters_path','requestParameters_encryptionContext_PARAMETER_ARN', 'requestParameters_name',
                             'requestParameters_pipelineName','requestParameters_maxResults', 'userIdentity_accessKeyId', 'eventTime_weekend', 'eventTime_weekday', 'eventTime_bin', 'userIdentity_userName'
                            })
    original_user_keys = {'userIdentity_accessKeyId', 'eventTime_weekend','eventTime_weekday', 'eventTime_bin', 'userIdentity_userName',}
    original_op_keys = {"sourceIPAddress", "userIdentity_sessionContext_attributes_mfaAuthenticated", "eventType", "eventSource", "userAgent_general_bin", "userAgent_bin", "eventName"}

    # log_universe_generator = LogUniverseGenerator(selector.event_normalizer, job['perm_universe_query'])
    # param_info_id = log_universe_generator.build_log_universe(600000)
    # event_enumerator = EventEnumerator('56531ac20e9402e22b62fa6064c69957', original_user_keys)
    # for event in event_enumerator.generate_events():
    #     print(event)

    # valid_keys = {'eventType', 'eventName', 'eventSource', 'requestParameters_path','requestParameters_encryptionContext_PARAMETER_ARN', 'requestParameters_name', 'requestParameters_pipelineName','requestParameters_maxResults'}
    # selector.pandas_corr_no_vect(100000, valid_keys, {'eventTime', 'eventName', 'sourceIPAddress', 'userIdentity_accessKeyId', 'userAgent'}, 0.50, True)
    # selector.build_log_universe(600000)
    # selector.print_normd_events_csv(0.1, valid_keys, {'eventTime', 'eventName', 'sourceIPAddress', 'userIdentity_accessKeyId', 'userAgent'}, 0.90, True)


    # selector.correlate_keys(1.0, valid_keys, {'eventTime', 'eventName', 'sourceIPAddress', 'userIdentity_accessKeyId', 'userAgent'}, 0.90, False, True)
    # selector.correlate_keys(0.1, valid_keys, {'eventTime', 'eventName', 'sourceIPAddress', 'userIdentity_accessKeyId', 'userAgent'}, 0.50, True, False)